<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{-|
== Suffix tree

A moderately simple and flexible suffix tree.
A suffix tree of a string is a compressed trie of all the suffixes of the string, useful for fast
matching on substrings of the string or to calculate certain properties of the string.
Other suffix structures such as suffix arrays and suffix automata may serve as alternates to suffix
trees.

The implementation here constructs a SuffixTree a from a given string index function, with string
elements of type Int. Ukkonen's algorithm is used for construction. This is not lazy, the entire
tree is constructed right away.
Only the implicit suffix tree is constructed, which is a suffix tree where suffixes that are
prefixes of other suffixes do not end in leaves. To make them end in leaves, set the last element
of the string to a unique value.
A SuffixTree a also stores accumulated values of type a at every node. These values are calculated
using user supplied functions, which can be chosen based on what the tree will be used for.

Sources:

* Esko Ukkonen, &quot;On&#8211;line construction of suffix trees&quot;, 1995
  https://www.cs.helsinki.fi/u/ukkonen/SuffixT1withFigs.pdf
* Dan Gusfield, &quot;Algorithms on Strings, Trees, and Sequences&quot;, 1997
  https://doi.org/10.1017/CBO9780511574931

String indexing is assumed to take O(1). Let k be the alphabet size. Let the complexity of IntMap
operations be f(n), where n is the size of the map. f(n) is O(min(n, word size)), see IntMap
documentation for details.

-}</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">{-
Implementation notes:
* Ukkonen's algorithm is used to construct the suffix tree. The implementation here is similar to
  the one in his paper. The state maintained is (u, pos). For index i the substring [pos..i] must be
  inserted at node u, then at the suffix link of u, and so on.
* buildSufT builds a nicer-to-use tree on top of arrays calculated by Ukkonen's algorithm.
* Suffix links, which can be useful in some situations, are not retained for simplicity.
* There is no setup for fast LCA queries, which are also useful in some situations.
* matchSufT can be easily modified to return the value for the longest prefix of the pattern
  matched, if it does not match completely.
-}</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SuffixTree</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier">SufTNode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier">SufTEdge</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier">Chr</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SuffixTree.html#buildSufT"><span class="hs-identifier">buildSufT</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SuffixTree.html#matchSufT"><span class="hs-identifier">matchSufT</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SuffixTree.html#buildMatchSufT"><span class="hs-identifier">buildMatchSufT</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SuffixTree.html#drawSufT"><span class="hs-identifier">drawSufT</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.ST</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.Unboxed</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.Unsafe</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IM</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TreeDraw.html"><span class="hs-identifier">TreeDraw</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="TreeDraw.html#draw"><span class="hs-identifier">draw</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">type</span><span> </span><span id="Chr"><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-var">Chr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">data</span><span> </span><span id="SufTNode"><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-var">SufTNode</span></a></span></span><span> </span><span id="local-6989586621679075266"><span class="annot"><a href="#local-6989586621679075266"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SufTNode"><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-var">SufTNode</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679075266"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-type">SufTEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075266"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">data</span><span> </span><span id="SufTEdge"><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-var">SufTEdge</span></a></span></span><span> </span><span id="local-6989586621679075263"><span class="annot"><a href="#local-6989586621679075263"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SufTEdge"><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-var">SufTEdge</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075263"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Builds a suffix tree. n is the length of the string. at is a 0-based indexing function into the</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- string. fromLeaf constructs a value from a leaf index. updEdge constructs a value from an existing</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- value and a length of an edge leading to it. merge combines two values.</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- Examples:</span><span>
</span><span id="line-75"></span><span class="hs-comment">--   To query the number of times a pattern occurs in the string, use const 1, const, and (+).</span><span>
</span><span id="line-76"></span><span class="hs-comment">--   To calculate the number of distinct substrings, use const 0, (+), and (+).</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- O(n * f(k)), plus the above functions are each called O(n) times.</span><span>
</span><span id="line-78"></span><span id="local-6989586621679075185"><span class="annot"><a href="SuffixTree.html#buildSufT"><span class="hs-identifier hs-type">buildSufT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-type">Chr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075185"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-81"></span><span id="buildSufT"><span class="annot"><span class="annottext">buildSufT :: (Int -&gt; a)
-&gt; (a -&gt; Int -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Int
-&gt; (Int -&gt; Int)
-&gt; SufTNode a
</span><a href="SuffixTree.html#buildSufT"><span class="hs-identifier hs-var hs-var">buildSufT</span></a></span></span><span> </span><span id="local-6989586621679075165"><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621679075165"><span class="hs-identifier hs-var">fromLeaf</span></a></span></span><span> </span><span id="local-6989586621679075164"><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075164"><span class="hs-identifier hs-var">updEdge</span></a></span></span><span> </span><span id="local-6989586621679075163"><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621679075163"><span class="hs-identifier hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621679075162"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075162"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679075161"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075161"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SufTNode a
</span><a href="#local-6989586621679075160"><span class="hs-identifier hs-var">mkNode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075162"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075159"><span class="annot"><span class="annottext">Array Int (IntMap Int)
</span><a href="#local-6989586621679075159"><span class="hs-identifier hs-var">nxta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075158"><span class="annot"><span class="annottext">UArray Int Int
</span><a href="#local-6989586621679075158"><span class="hs-identifier hs-var">lefta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075157"><span class="annot"><span class="annottext">UArray Int Int
</span><a href="#local-6989586621679075157"><span class="hs-identifier hs-var">lena</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Int)
-&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int)
</span><a href="SuffixTree.html#ukkonen"><span class="hs-identifier hs-var">ukkonen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075162"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075161"><span class="hs-identifier hs-var">at</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679075160"><span class="annot"><span class="annottext">mkNode :: Int -&gt; Int -&gt; SufTNode a
</span><a href="#local-6989586621679075160"><span class="hs-identifier hs-var hs-var">mkNode</span></a></span></span><span> </span><span id="local-6989586621679075155"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075155"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span id="local-6989586621679075154"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075154"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; IntMap (SufTEdge a) -&gt; SufTNode a
forall a. a -&gt; IntMap (SufTEdge a) -&gt; SufTNode a
</span><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-var">SufTNode</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075153"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075152"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>        </span><span id="local-6989586621679075152"><span class="annot"><span class="annottext">nxt :: IntMap (SufTEdge a)
</span><a href="#local-6989586621679075152"><span class="hs-identifier hs-var hs-var">nxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SufTEdge a) -&gt; IntMap Int -&gt; IntMap (SufTEdge a)
forall a b. (a -&gt; b) -&gt; IntMap a -&gt; IntMap b
</span><span class="hs-identifier hs-var">IM.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679075150"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SufTNode a -&gt; SufTEdge a
forall a. Int -&gt; Int -&gt; SufTNode a -&gt; SufTEdge a
</span><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-var">SufTEdge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Int Int
</span><a href="#local-6989586621679075158"><span class="hs-identifier hs-var">lefta</span></a></span><span class="annot"><span class="annottext">UArray Int Int -&gt; Int -&gt; Int
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Int Int
</span><a href="#local-6989586621679075157"><span class="hs-identifier hs-var">lena</span></a></span><span class="annot"><span class="annottext">UArray Int Int -&gt; Int -&gt; Int
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SufTNode a
</span><a href="#local-6989586621679075160"><span class="hs-identifier hs-var">mkNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075155"><span class="hs-identifier hs-var">dep</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">UArray Int Int
</span><a href="#local-6989586621679075157"><span class="hs-identifier hs-var">lena</span></a></span><span class="annot"><span class="annottext">UArray Int Int -&gt; Int -&gt; Int
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int (IntMap Int)
</span><a href="#local-6989586621679075159"><span class="hs-identifier hs-var">nxta</span></a></span><span class="annot"><span class="annottext">Array Int (IntMap Int) -&gt; Int -&gt; IntMap Int
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075154"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>        </span><span id="local-6989586621679075153"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679075153"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a) -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IM.null</span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075152"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621679075165"><span class="hs-identifier hs-var">fromLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075155"><span class="hs-identifier hs-var">dep</span></a></span><span>
</span><span id="line-86"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">foldl1'</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621679075163"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075164"><span class="hs-identifier hs-var">updEdge</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075146"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075145"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-type">SufTEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679075145"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075145"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span id="local-6989586621679075146"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075146"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a) -&gt; [SufTEdge a]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IM.elems</span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075152"><span class="hs-identifier hs-var">nxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="SuffixTree.html#ukkonen"><span class="hs-identifier hs-type">ukkonen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-type">Chr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span id="ukkonen"><span class="annot"><span class="annottext">ukkonen :: Int
-&gt; (Int -&gt; Int)
-&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int)
</span><a href="SuffixTree.html#ukkonen"><span class="hs-identifier hs-var hs-var">ukkonen</span></a></span></span><span> </span><span id="local-6989586621679075143"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075143"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679075142"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s.
 ST s (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
-&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int)
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s.
  ST s (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
 -&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
-&gt; (forall s.
    ST s (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
-&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679075140"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621679075140"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075143"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075143"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679075136"><span id="local-6989586621679075135"><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679075136"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; IntMap Int -&gt; ST s (STArray s Int (IntMap Int))
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075140"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap Int
forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679075132"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075132"><span class="hs-identifier hs-var">suf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075131"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075131"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075130"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075130"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679075136"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (STUArray s Int Int) -&gt; ST s [STUArray s Int Int]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int -&gt; ST s (STUArray s Int Int)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075140"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679075128"><span class="annot"><span class="annottext">STUArray s () Int
</span><a href="#local-6989586621679075128"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679075136"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((), ()) -&gt; Int -&gt; ST s (STUArray s () Int)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679075127"><span class="annot"><span class="annottext">root :: Int
</span><a href="#local-6989586621679075127"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-95"></span><span>        </span><span id="local-6989586621679075126"><span class="annot"><span class="annottext">nxtId :: ST s Int
</span><a href="#local-6989586621679075126"><span class="hs-identifier hs-var hs-var">nxtId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STUArray s () Int -&gt; () -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s () Int
</span><a href="#local-6989586621679075128"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ST s Int -&gt; (Int -&gt; ST s Int) -&gt; ST s Int
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679075124"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075124"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075124"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s () -&gt; ST s Int
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">STUArray s () Int -&gt; () -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s () Int
</span><a href="#local-6989586621679075128"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075124"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>        </span><span id="local-6989586621679075121"><span class="annot"><span class="annottext">step :: Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075121"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679075120"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075119"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075127"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>            </span><span id="local-6989586621679075119"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075119"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679075118"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075118"><span class="hs-identifier hs-var">prv</span></a></span></span><span> </span><span id="local-6989586621679075117"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679075116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>                </span><span id="local-6989586621679075115"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075115"><span class="hs-identifier hs-var">nxtu</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int) -&gt; Int -&gt; ST s (IntMap Int)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-99"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075115"><span class="hs-identifier hs-var">nxtu</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; Int -&gt; Maybe Int
forall a. IntMap a -&gt; Int -&gt; Maybe a
</span><span class="hs-operator hs-var">IM.!?</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-100"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075113"><span class="hs-identifier hs-var">insLeafGo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-101"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679075112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075112"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s (ST s (Int, Int)) -&gt; ST s (Int, Int)
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(ST s (ST s (Int, Int)) -&gt; ST s (Int, Int))
-&gt; ST s (ST s (Int, Int)) -&gt; ST s (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075111"><span class="hs-identifier hs-var">tryEdge</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075115"><span class="hs-identifier hs-var">nxtu</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075112"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; ST s (Int, Int))
-&gt; ST s Int -&gt; ST s (Int -&gt; ST s (Int, Int))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075131"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075112"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (Int -&gt; ST s (Int, Int)) -&gt; ST s Int -&gt; ST s (ST s (Int, Int))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075130"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075112"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-102"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>                </span><span id="local-6989586621679075111"><span class="annot"><span class="annottext">tryEdge :: IntMap Int -&gt; Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075111"><span class="hs-identifier hs-var hs-var">tryEdge</span></a></span></span><span> </span><span id="local-6989586621679075109"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075109"><span class="hs-identifier hs-var">nxtu</span></a></span></span><span> </span><span id="local-6989586621679075108"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075108"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679075107"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075107"><span class="hs-identifier hs-var">leftv</span></a></span></span><span> </span><span id="local-6989586621679075106"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075106"><span class="hs-identifier hs-var">lenv</span></a></span></span><span>
</span><span id="line-104"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075106"><span class="hs-identifier hs-var">lenv</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075119"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075118"><span class="hs-identifier hs-var">prv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075106"><span class="hs-identifier hs-var">lenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075108"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-105"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075103"><span class="hs-identifier hs-var">j</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s Int
</span><a href="#local-6989586621679075102"><span class="hs-identifier hs-var">doSplit</span></a></span><span> </span><span class="annot"><span class="annottext">ST s Int -&gt; (Int -&gt; ST s (Int, Int)) -&gt; ST s (Int, Int)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075113"><span class="hs-identifier hs-var">insLeafGo</span></a></span><span>
</span><span id="line-106"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075107"><span class="hs-identifier hs-var">leftv</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075101"><span class="hs-identifier hs-var">goSuf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-107"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s () -&gt; ST s (Int, Int)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679075100"><span class="hs-identifier hs-var">setSufPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-108"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>                    </span><span id="local-6989586621679075099"><span class="annot"><span class="annottext">lenw :: Int
</span><a href="#local-6989586621679075099"><span class="hs-identifier hs-var hs-var">lenw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-110"></span><span>                    </span><span id="local-6989586621679075103"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621679075103"><span class="hs-identifier hs-var hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075107"><span class="hs-identifier hs-var">leftv</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075099"><span class="hs-identifier hs-var">lenw</span></a></span><span>
</span><span id="line-111"></span><span>                    </span><span id="local-6989586621679075102"><span class="annot"><span class="annottext">doSplit :: ST s Int
</span><a href="#local-6989586621679075102"><span class="hs-identifier hs-var hs-var">doSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>                        </span><span id="local-6989586621679075098"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075098"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s Int
</span><a href="#local-6989586621679075126"><span class="hs-identifier hs-var">nxtId</span></a></span><span>
</span><span id="line-113"></span><span>                        </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075131"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075098"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075107"><span class="hs-identifier hs-var">leftv</span></a></span><span>
</span><span id="line-114"></span><span>                        </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075130"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075098"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075099"><span class="hs-identifier hs-var">lenw</span></a></span><span>
</span><span id="line-115"></span><span>                        </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int) -&gt; Int -&gt; IntMap Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075098"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Int -&gt; ST s ()) -&gt; IntMap Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075103"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075108"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-116"></span><span>                        </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075131"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075108"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075107"><span class="hs-identifier hs-var">leftv</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075099"><span class="hs-identifier hs-var">lenw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>                        </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075130"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075108"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075106"><span class="hs-identifier hs-var">lenv</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075099"><span class="hs-identifier hs-var">lenw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>                        </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int) -&gt; Int -&gt; IntMap Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Int -&gt; ST s ()) -&gt; IntMap Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075098"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075109"><span class="hs-identifier hs-var">nxtu</span></a></span><span>
</span><span id="line-119"></span><span>                        </span><span class="annot"><span class="annottext">Int -&gt; ST s Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075098"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-120"></span><span>                </span><span id="local-6989586621679075113"><span class="annot"><span class="annottext">insLeafGo :: Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075113"><span class="hs-identifier hs-var hs-var">insLeafGo</span></a></span></span><span> </span><span id="local-6989586621679075094"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075094"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679075100"><span class="hs-identifier hs-var">setSufPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075094"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ST s () -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679075093"><span class="hs-identifier hs-var">insLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075094"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ST s () -&gt; ST s (Int, Int) -&gt; ST s (Int, Int)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075101"><span class="hs-identifier hs-var">goSuf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075094"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-121"></span><span>                </span><span id="local-6989586621679075100"><span class="annot"><span class="annottext">setSufPrv :: Int -&gt; ST s ()
</span><a href="#local-6989586621679075100"><span class="hs-identifier hs-var hs-var">setSufPrv</span></a></span></span><span> </span><span id="local-6989586621679075092"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075092"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075132"><span class="hs-identifier hs-var">suf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075118"><span class="hs-identifier hs-var">prv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075092"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679075136"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>                </span><span id="local-6989586621679075093"><span class="annot"><span class="annottext">insLeaf :: Int -&gt; ST s ()
</span><a href="#local-6989586621679075093"><span class="hs-identifier hs-var hs-var">insLeaf</span></a></span></span><span> </span><span id="local-6989586621679075091"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075091"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>                    </span><span id="local-6989586621679075090"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075090"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s Int
</span><a href="#local-6989586621679075126"><span class="hs-identifier hs-var">nxtId</span></a></span><span>
</span><span id="line-124"></span><span>                    </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075131"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075090"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-125"></span><span>                    </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075130"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075090"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075143"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>                    </span><span id="local-6989586621679075089"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075089"><span class="hs-identifier hs-var">nxtv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int) -&gt; Int -&gt; ST s (IntMap Int)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075091"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-127"></span><span>                    </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int) -&gt; Int -&gt; IntMap Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075091"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Int -&gt; ST s ()) -&gt; IntMap Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075142"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075090"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679075089"><span class="hs-identifier hs-var">nxtv</span></a></span><span>
</span><span id="line-128"></span><span>                </span><span id="local-6989586621679075101"><span class="annot"><span class="annottext">goSuf :: Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075101"><span class="hs-identifier hs-var hs-var">goSuf</span></a></span></span><span> </span><span id="local-6989586621679075088"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075088"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-129"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075127"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075132"><span class="hs-identifier hs-var">suf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075116"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">ST s Int -&gt; (Int -&gt; ST s (Int, Int)) -&gt; ST s (Int, Int)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075119"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075088"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-130"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075120"><span class="hs-identifier hs-var">i</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075119"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075088"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075127"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-131"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (Int, Int)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075127"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075117"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Int -&gt; ST s (Int, Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679075085"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075085"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075084"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075084"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075083"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075083"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679075121"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075083"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075084"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075085"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075127"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075143"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Array Int (IntMap Int)
 -&gt; UArray Int Int
 -&gt; UArray Int Int
 -&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
-&gt; ST s (Array Int (IntMap Int))
-&gt; ST
     s
     (UArray Int Int
      -&gt; UArray Int Int
      -&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int) -&gt; ST s (Array Int (IntMap Int))
forall i (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) (b :: * -&gt; * -&gt; *).
(Ix i, MArray a e m, IArray b e) =&gt;
a i e -&gt; m (b i e)
</span><span class="hs-identifier hs-var">unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (IntMap Int)
</span><a href="#local-6989586621679075135"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">ST
  s
  (UArray Int Int
   -&gt; UArray Int Int
   -&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
-&gt; ST s (UArray Int Int)
-&gt; ST
     s
     (UArray Int Int
      -&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (UArray Int Int)
forall i (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) (b :: * -&gt; * -&gt; *).
(Ix i, MArray a e m, IArray b e) =&gt;
a i e -&gt; m (b i e)
</span><span class="hs-identifier hs-var">unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075131"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">ST
  s
  (UArray Int Int
   -&gt; (Array Int (IntMap Int), UArray Int Int, UArray Int Int))
-&gt; ST s (UArray Int Int)
-&gt; ST s (Array Int (IntMap Int), UArray Int Int, UArray Int Int)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (UArray Int Int)
forall i (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) (b :: * -&gt; * -&gt; *).
(Ix i, MArray a e m, IArray b e) =&gt;
a i e -&gt; m (b i e)
</span><span class="hs-identifier hs-var">unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679075130"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Matches a pattern on the suffix tree. updEdge and at are as defined for buildSufT. m is the length</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- of the pattern. at' is a 0-based indexing function into the pattern. If the pattern is not present,</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- returns Nothing. Otherwise returns the accumulated value for the subtree where the pattern ends.</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- O(m * f(k)) plus at most one call of updEdge.</span><span>
</span><span id="line-139"></span><span id="local-6989586621679075186"><span class="annot"><a href="SuffixTree.html#matchSufT"><span class="hs-identifier hs-type">matchSufT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679075186"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075186"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-type">Chr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075186"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-type">Chr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679075186"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-142"></span><span id="matchSufT"><span class="annot"><span class="annottext">matchSufT :: (a -&gt; Int -&gt; a)
-&gt; (Int -&gt; Int) -&gt; SufTNode a -&gt; Int -&gt; (Int -&gt; Int) -&gt; Maybe a
</span><a href="SuffixTree.html#matchSufT"><span class="hs-identifier hs-var hs-var">matchSufT</span></a></span></span><span> </span><span id="local-6989586621679075081"><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075081"><span class="hs-identifier hs-var">updEdge</span></a></span></span><span> </span><span id="local-6989586621679075080"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075080"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span id="local-6989586621679075079"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075079"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679075078"><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075078"><span class="hs-identifier hs-var">nxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075077"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075077"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679075076"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075076"><span class="hs-identifier hs-var">at'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075077"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075079"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a) -&gt; Int -&gt; Maybe a
</span><a href="#local-6989586621679075075"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075078"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679075075"><span class="annot"><span class="annottext">go :: IntMap (SufTEdge a) -&gt; Int -&gt; Maybe a
</span><a href="#local-6989586621679075075"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679075074"><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075074"><span class="hs-identifier hs-var">nxt</span></a></span></span><span> </span><span id="local-6989586621679075073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075073"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap (SufTEdge a) -&gt; Maybe (SufTEdge a)
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075076"><span class="hs-identifier hs-var">at'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075073"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075074"><span class="hs-identifier hs-var">nxt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SufTEdge a) -&gt; (SufTEdge a -&gt; Maybe a) -&gt; Maybe a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SufTEdge a -&gt; Maybe a
</span><a href="#local-6989586621679075071"><span class="hs-identifier hs-var">go'</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>        </span><span id="local-6989586621679075071"><span class="annot"><span class="annottext">go' :: SufTEdge a -&gt; Maybe a
</span><a href="#local-6989586621679075071"><span class="hs-identifier hs-var hs-var">go'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-type">SufTEdge</span></a></span><span> </span><span id="local-6989586621679075070"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075070"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621679075069"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075069"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span id="local-6989586621679075068"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075068"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679075067"><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075067"><span class="hs-identifier hs-var">nxt'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075066"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075077"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075064"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075069"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075068"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075066"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075077"><span class="hs-identifier hs-var">m</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075081"><span class="hs-identifier hs-var">updEdge</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075068"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075069"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075064"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075064"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075069"><span class="hs-identifier hs-var">len</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a) -&gt; Int -&gt; Maybe a
</span><a href="#local-6989586621679075075"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075067"><span class="hs-identifier hs-var">nxt'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075066"><span class="hs-identifier hs-var">i'</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>            </span><span id="local-6989586621679075064"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621679075064"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Int) -&gt; (Int -&gt; Int) -&gt; Int
forall t a. (Eq t, Eq a, Num t) =&gt; t -&gt; (t -&gt; a) -&gt; (t -&gt; a) -&gt; t
</span><a href="#local-6989586621679075063"><span class="hs-identifier hs-var">commonPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075069"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075077"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075073"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075080"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075070"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075076"><span class="hs-identifier hs-var">at'</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075073"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>            </span><span id="local-6989586621679075066"><span class="annot"><span class="annottext">i' :: Int
</span><a href="#local-6989586621679075066"><span class="hs-identifier hs-var hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075073"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075064"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679075063"><span class="annot"><span class="annottext">commonPrefix :: t -&gt; (t -&gt; a) -&gt; (t -&gt; a) -&gt; t
</span><a href="#local-6989586621679075063"><span class="hs-identifier hs-var hs-var">commonPrefix</span></a></span></span><span> </span><span id="local-6989586621679075060"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679075060"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679075059"><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621679075059"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679075058"><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621679075058"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(t -&gt; Bool) -&gt; (t -&gt; t) -&gt; t -&gt; t
forall a. (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">until</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679075056"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679075056"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679075056"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679075060"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621679075059"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679075056"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621679075058"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679075056"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | buildSufT together with matchSufT to avoid having to repeat arguments. Apply partially for</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- multiple queries.</span><span>
</span><span id="line-156"></span><span id="local-6989586621679075054"><span class="annot"><a href="SuffixTree.html#buildMatchSufT"><span class="hs-identifier hs-type">buildMatchSufT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-type">Chr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#Chr"><span class="hs-identifier hs-type">Chr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679075054"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-160"></span><span id="buildMatchSufT"><span class="annot"><span class="annottext">buildMatchSufT :: (Int -&gt; a)
-&gt; (a -&gt; Int -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Int
-&gt; (Int -&gt; Int)
-&gt; Int
-&gt; (Int -&gt; Int)
-&gt; Maybe a
</span><a href="SuffixTree.html#buildMatchSufT"><span class="hs-identifier hs-var hs-var">buildMatchSufT</span></a></span></span><span> </span><span id="local-6989586621679075053"><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621679075053"><span class="hs-identifier hs-var">fromLeaf</span></a></span></span><span> </span><span id="local-6989586621679075052"><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075052"><span class="hs-identifier hs-var">updEdge</span></a></span></span><span> </span><span id="local-6989586621679075051"><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621679075051"><span class="hs-identifier hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621679075050"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075050"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679075049"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075049"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Int -&gt; a)
-&gt; (Int -&gt; Int) -&gt; SufTNode a -&gt; Int -&gt; (Int -&gt; Int) -&gt; Maybe a
forall a.
(a -&gt; Int -&gt; a)
-&gt; (Int -&gt; Int) -&gt; SufTNode a -&gt; Int -&gt; (Int -&gt; Int) -&gt; Maybe a
</span><a href="SuffixTree.html#matchSufT"><span class="hs-identifier hs-var">matchSufT</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075052"><span class="hs-identifier hs-var">updEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075049"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">SufTNode a
</span><a href="#local-6989586621679075048"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679075048"><span class="annot"><span class="annottext">st :: SufTNode a
</span><a href="#local-6989586621679075048"><span class="hs-identifier hs-var hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a)
-&gt; (a -&gt; Int -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Int
-&gt; (Int -&gt; Int)
-&gt; SufTNode a
forall a.
(Int -&gt; a)
-&gt; (a -&gt; Int -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Int
-&gt; (Int -&gt; Int)
-&gt; SufTNode a
</span><a href="SuffixTree.html#buildSufT"><span class="hs-identifier hs-var">buildSufT</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621679075053"><span class="hs-identifier hs-var">fromLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
</span><a href="#local-6989586621679075052"><span class="hs-identifier hs-var">updEdge</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621679075051"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075050"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679075049"><span class="hs-identifier hs-var">at</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- For tests</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621679075047"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679075047"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-type">SufTEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075047"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679075044"><span class="annot"><span class="annottext">rnf :: SufTEdge a -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-type">SufTEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679075042"><span class="annot"><span class="annottext">SufTNode a
</span><a href="#local-6989586621679075042"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SufTNode a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">SufTNode a
</span><a href="#local-6989586621679075042"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span id="local-6989586621679075041"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679075041"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075041"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679075039"><span class="annot"><span class="annottext">rnf :: SufTNode a -&gt; ()
</span><a href="#local-6989586621679075039"><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span id="local-6989586621679075038"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075038"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679075037"><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075037"><span class="hs-identifier hs-var">nxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075038"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a) -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075037"><span class="hs-identifier hs-var">nxt</span></a></span></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- | Draws a suffix tree. Can be used for debugging.</span><span>
</span><span id="line-173"></span><span id="local-6989586621679075036"><span class="annot"><a href="SuffixTree.html#drawSufT"><span class="hs-identifier hs-type">drawSufT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679075036"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679075036"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-174"></span><span id="drawSufT"><span class="annot"><span class="annottext">drawSufT :: SufTNode a -&gt; String
</span><a href="SuffixTree.html#drawSufT"><span class="hs-identifier hs-var hs-var">drawSufT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SufTNode a -&gt; String)
-&gt; (SufTNode a -&gt; [(Maybe String, SufTNode a)])
-&gt; SufTNode a
-&gt; String
forall a.
(a -&gt; String) -&gt; (a -&gt; [(Maybe String, a)]) -&gt; a -&gt; String
</span><a href="TreeDraw.html#draw"><span class="hs-identifier hs-var">draw</span></a></span><span> </span><span class="annot"><span class="annottext">SufTNode a -&gt; String
forall a. Show a =&gt; SufTNode a -&gt; String
</span><a href="#local-6989586621679075035"><span class="hs-identifier hs-var">showa</span></a></span><span> </span><span class="annot"><span class="annottext">SufTNode a -&gt; [(Maybe String, SufTNode a)]
forall a. SufTNode a -&gt; [(Maybe String, SufTNode a)]
</span><a href="#local-6989586621679075034"><span class="hs-identifier hs-var">nbs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679075035"><span class="annot"><span class="annottext">showa :: SufTNode a -&gt; String
</span><a href="#local-6989586621679075035"><span class="hs-identifier hs-var hs-var">showa</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span id="local-6989586621679075033"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075033"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075033"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621679075034"><span class="annot"><span class="annottext">nbs :: SufTNode a -&gt; [(Maybe String, SufTNode a)]
</span><a href="#local-6989586621679075034"><span class="hs-identifier hs-var hs-var">nbs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SuffixTree.html#SufTNode"><span class="hs-identifier hs-type">SufTNode</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679075031"><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075031"><span class="hs-identifier hs-var">nxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075030"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075029"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SufTNode a
</span><a href="#local-6989586621679075028"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="SuffixTree.html#SufTEdge"><span class="hs-identifier hs-type">SufTEdge</span></a></span><span> </span><span id="local-6989586621679075030"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075030"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621679075029"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075029"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679075028"><span class="annot"><span class="annottext">SufTNode a
</span><a href="#local-6989586621679075028"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a) -&gt; [SufTEdge a]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IM.elems</span></span><span> </span><span class="annot"><span class="annottext">IntMap (SufTEdge a)
</span><a href="#local-6989586621679075031"><span class="hs-identifier hs-var">nxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-177"></span></pre></body></html>