<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{-|
== Mutable segment tree

See SegTree. SegTreeMut is just that, but backed by a mutable array.
With unboxed arrays, SegTreeMut is multiple times faster than SegTree (see benchmarks).
However, this comes at the cost of purity.

Sources:

* Al.Cash, &quot;Efficient and easy segment trees&quot;
  https://codeforces.com/blog/entry/18051
* AtCoder Library
  https://github.com/atcoder/ac-library/blob/master/atcoder/segtree.hpp

Let n = r - l + 1 where (l, r) is the range of the segment tree.
The complexities assume (&lt;&gt;) takes O(1) time.

-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-comment">{-
Implementation notes:
* The implementation here is a bottom-up implementation, sometimes called &quot;iterative&quot; segment tree.
  A top-down implementation also works, but is generally slower.
* The values of the tree are stored in an Int-indexed array. Nodes are represented by Ints, which
  are the indices where the value of the node is stored. The value of the root is stored at index 1.
  The childen of node i are 2*i and 2*i+1. Each node covers a range the size of which is a power of
  2, and the two children of the node, if it's not a leaf, cover the two halves of that range.
* Operations on the tree proceed bottom-up, from the leaves towards the root. Due to the uniform
  structure of the tree it is easy and efficient to traverse the tree by manipulating indices.
* INLINE on setSNM is critical!
* The &quot;unsafe&quot; bitwise ops are safe in the given conditions. For instance,
  x `unsafeShiftR` (ctz (x+1)) is safe if x is not -1. These are used only where it will be run many
  many times and will make a difference.
-}</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SegTreeMut</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier">SegTreeMut</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTreeMut.html#emptySTM"><span class="hs-identifier">emptySTM</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTreeMut.html#fromListSTM"><span class="hs-identifier">fromListSTM</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTreeMut.html#adjustSTM"><span class="hs-identifier">adjustSTM</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTreeMut.html#foldRangeSTM"><span class="hs-identifier">foldRangeSTM</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTreeMut.html#binSearchSTM"><span class="hs-identifier">binSearchSTM</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTreeMut.html#foldrSTM"><span class="hs-identifier">foldrSTM</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.MArray</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Misc.html"><span class="hs-identifier">Misc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Misc.html#bitLength"><span class="hs-identifier">bitLength</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Misc.html#modifyArray%27"><span class="hs-identifier">modifyArray'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Misc.html#unsafeBit"><span class="hs-identifier">unsafeBit</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="SegTreeMut"><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-var">SegTreeMut</span></a></span></span><span> </span><span id="local-6989586621679080323"><span class="annot"><a href="#local-6989586621679080323"><span class="hs-identifier hs-type">marr</span></a></span></span><span> </span><span id="local-6989586621679080322"><span class="annot"><a href="#local-6989586621679080322"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="STM"><span class="annot"><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-var">STM</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080323"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679080322"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | Builds a segment tree on (l, r) where each element is mempty. O(n).</span><span>
</span><span id="line-57"></span><span id="local-6989586621679080234"><span id="local-6989586621679080235"><span id="local-6989586621679080236"><span class="annot"><a href="SegTreeMut.html#emptySTM"><span class="hs-identifier hs-type">emptySTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080236"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080235"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080236"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080234"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080234"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-type">SegTreeMut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080235"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080236"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-58"></span><span id="emptySTM"><span class="annot"><span class="annottext">emptySTM :: (Int, Int) -&gt; m (SegTreeMut marr a)
</span><a href="SegTreeMut.html#emptySTM"><span class="hs-identifier hs-var hs-var">emptySTM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080233"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080233"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679080232"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080232"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080232"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080233"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m (SegTreeMut marr a)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;emptySTM: bad range&quot;</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080228"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679080228"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Bits a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">bit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><a href="Misc.html#bitLength"><span class="hs-identifier hs-var">bitLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080232"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080233"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>        </span><span id="local-6989586621679080226"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080226"><span class="hs-identifier hs-var">xa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; a -&gt; m (marr Int a)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080228"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="annottext">SegTreeMut marr a -&gt; m (SegTreeMut marr a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SegTreeMut marr a -&gt; m (SegTreeMut marr a))
-&gt; SegTreeMut marr a -&gt; m (SegTreeMut marr a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; marr Int a -&gt; SegTreeMut marr a
forall (marr :: * -&gt; * -&gt; *) a.
Int -&gt; Int -&gt; Int -&gt; marr Int a -&gt; SegTreeMut marr a
</span><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-var">STM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080233"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080232"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080228"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080226"><span class="hs-identifier hs-var">xa</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621679080287"><span id="local-6989586621679080288"><span id="local-6989586621679080289"><span class="annot"><a href="SegTreeMut.html#setSNM"><span class="hs-identifier hs-type">setSNM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080289"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080288"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080289"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080287"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080288"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679080289"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080287"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-66"></span><span id="setSNM"><span class="annot"><span class="annottext">setSNM :: marr Int a -&gt; Int -&gt; m ()
</span><a href="SegTreeMut.html#setSNM"><span class="hs-identifier hs-var hs-var">setSNM</span></a></span></span><span> </span><span id="local-6989586621679080221"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080221"><span class="hs-identifier hs-var">xa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679080220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080220"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; m a -&gt; m (a -&gt; a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; m a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080221"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080220"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (a -&gt; a) -&gt; m a -&gt; m a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; m a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080221"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080220"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; a -&gt; m ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080221"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080220"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m ()) -&gt; a -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="SegTreeMut.html#setSNM"><span class="hs-pragma hs-type">setSNM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | Builds a segment tree on (l, r) where the elements are taken from a list. If the list is shorter</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- than the range, the remaining elements are mempty. O(n).</span><span>
</span><span id="line-71"></span><span id="local-6989586621679080214"><span id="local-6989586621679080215"><span id="local-6989586621679080216"><span class="annot"><a href="SegTreeMut.html#fromListSTM"><span class="hs-identifier hs-type">fromListSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080216"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080215"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080214"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679080216"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080214"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-type">SegTreeMut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080215"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080216"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-72"></span><span id="fromListSTM"><span class="annot"><span class="annottext">fromListSTM :: (Int, Int) -&gt; [a] -&gt; m (SegTreeMut marr a)
</span><a href="SegTreeMut.html#fromListSTM"><span class="hs-identifier hs-var hs-var">fromListSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080213"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679080212"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080211"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679080211"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m (SegTreeMut marr a)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fromListSTM: bad range&quot;</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080210"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Bits a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">bit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><a href="Misc.html#bitLength"><span class="hs-identifier hs-var">bitLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>        </span><span id="local-6989586621679080209"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080209"><span class="hs-identifier hs-var">xa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; a -&gt; m (marr Int a)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">[(Int, a)] -&gt; ((Int, a) -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [a] -&gt; [(Int, a)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679080211"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Int, a) -&gt; m ()) -&gt; m ()) -&gt; ((Int, a) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a -&gt; m ()) -&gt; (Int, a) -&gt; m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; a -&gt; m ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080209"><span class="hs-identifier hs-var">xa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; m ()
forall a (marr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(Monoid a, MArray marr a m) =&gt;
marr Int a -&gt; Int -&gt; m ()
</span><a href="SegTreeMut.html#setSNM"><span class="hs-identifier hs-var">setSNM</span></a></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080209"><span class="hs-identifier hs-var">xa</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="annottext">SegTreeMut marr a -&gt; m (SegTreeMut marr a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SegTreeMut marr a -&gt; m (SegTreeMut marr a))
-&gt; SegTreeMut marr a -&gt; m (SegTreeMut marr a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; marr Int a -&gt; SegTreeMut marr a
forall (marr :: * -&gt; * -&gt; *) a.
Int -&gt; Int -&gt; Int -&gt; marr Int a -&gt; SegTreeMut marr a
</span><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-var">STM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080209"><span class="hs-identifier hs-var">xa</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Adjusts the element at index i. O(log n).</span><span>
</span><span id="line-82"></span><span id="local-6989586621679080204"><span id="local-6989586621679080205"><span id="local-6989586621679080206"><span class="annot"><a href="SegTreeMut.html#adjustSTM"><span class="hs-identifier hs-type">adjustSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080206"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080205"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080206"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-type">SegTreeMut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080205"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080206"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080206"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080206"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080204"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-83"></span><span id="adjustSTM"><span class="annot"><span class="annottext">adjustSTM :: SegTreeMut marr a -&gt; Int -&gt; (a -&gt; a) -&gt; m ()
</span><a href="SegTreeMut.html#adjustSTM"><span class="hs-identifier hs-var hs-var">adjustSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span id="local-6989586621679080203"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080203"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679080202"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080202"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679080201"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080201"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679080200"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080200"><span class="hs-identifier hs-var">xa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080199"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080199"><span class="hs-identifier hs-var">qi</span></a></span></span><span> </span><span id="local-6989586621679080198"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679080198"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080199"><span class="hs-identifier hs-var">qi</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080203"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080202"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080199"><span class="hs-identifier hs-var">qi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;adjustSTM: outside range&quot;</span></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080196"><span class="annot"><span class="annottext">qi' :: Int
</span><a href="#local-6989586621679080196"><span class="hs-identifier hs-var hs-var">qi'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080199"><span class="hs-identifier hs-var">qi</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080203"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080201"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; (a -&gt; a) -&gt; m ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; (e -&gt; e) -&gt; m ()
</span><a href="Misc.html#modifyArray%27"><span class="hs-identifier hs-var">modifyArray'</span></a></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080200"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080196"><span class="hs-identifier hs-var">qi'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679080198"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><span class="annottext">(Int -&gt; m ()) -&gt; [Int] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; m ()
forall a (marr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(Monoid a, MArray marr a m) =&gt;
marr Int a -&gt; Int -&gt; m ()
</span><a href="SegTreeMut.html#setSNM"><span class="hs-identifier hs-var">setSNM</span></a></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080200"><span class="hs-identifier hs-var">xa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; m ()) -&gt; [Int] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; [Int] -&gt; [Int]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; [Int]
forall a. (a -&gt; a) -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">iterate'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080196"><span class="hs-identifier hs-var">qi'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Folds the elements in the range (ql, qr). Elements outside (l, r) are considered to be mempty.</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- O(log n), or more precisely O(log(min(r, qr) - max(l, ql) + 1)).</span><span>
</span><span id="line-92"></span><span id="local-6989586621679080188"><span id="local-6989586621679080189"><span id="local-6989586621679080190"><span class="annot"><a href="SegTreeMut.html#foldRangeSTM"><span class="hs-identifier hs-type">foldRangeSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080190"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080189"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080190"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080188"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-type">SegTreeMut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080189"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080190"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080188"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080190"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-93"></span><span id="foldRangeSTM"><span class="annot"><span class="annottext">foldRangeSTM :: SegTreeMut marr a -&gt; Int -&gt; Int -&gt; m a
</span><a href="SegTreeMut.html#foldRangeSTM"><span class="hs-identifier hs-var hs-var">foldRangeSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span id="local-6989586621679080187"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080187"><span class="hs-identifier hs-var">l0</span></a></span></span><span> </span><span id="local-6989586621679080186"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080186"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span id="local-6989586621679080185"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080185"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679080184"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080184"><span class="hs-identifier hs-var">xa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080183"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080183"><span class="hs-identifier hs-var">ql</span></a></span></span><span> </span><span id="local-6989586621679080182"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080182"><span class="hs-identifier hs-var">qr</span></a></span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080182"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080183"><span class="hs-identifier hs-var">ql</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;foldRangeSTM: bad range&quot;</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080181"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">ql'</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>        </span><span id="local-6989586621679080179"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080179"><span class="hs-identifier hs-var">accL</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; m a
forall (f :: * -&gt; *).
MArray marr a f =&gt;
Int -&gt; Int -&gt; Int -&gt; a -&gt; f a
</span><a href="#local-6989586621679080178"><span class="hs-identifier hs-var">goUpRt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">ql'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080187"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080185"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">ql'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-98"></span><span>        </span><span id="local-6989586621679080177"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080177"><span class="hs-identifier hs-var">accR</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; m a
forall (f :: * -&gt; *).
MArray marr a f =&gt;
Int -&gt; Int -&gt; Int -&gt; a -&gt; f a
</span><a href="#local-6989586621679080176"><span class="hs-identifier hs-var">goUpLt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080181"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080187"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080185"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080181"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><span class="annottext">a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080179"><span class="hs-identifier hs-var">accL</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080177"><span class="hs-identifier hs-var">accR</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621679080180"><span class="annot"><span class="annottext">ql' :: Int
</span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var hs-var">ql'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080187"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080183"><span class="hs-identifier hs-var">ql</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621679080181"><span class="annot"><span class="annottext">qr' :: Int
</span><a href="#local-6989586621679080181"><span class="hs-identifier hs-var hs-var">qr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080186"><span class="hs-identifier hs-var">r0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080182"><span class="hs-identifier hs-var">qr</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679080178"><span class="annot"><span class="annottext">goUpRt :: Int -&gt; Int -&gt; Int -&gt; a -&gt; f a
</span><a href="#local-6989586621679080178"><span class="hs-identifier hs-var hs-var">goUpRt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080173"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080173"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080172"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080172"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080171"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080171"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080170"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080170"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080169"><span class="annot"><span class="annottext">tz :: Int
</span><a href="#local-6989586621679080169"><span class="hs-identifier hs-var hs-var">tz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countTrailingZeros</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080173"><span class="hs-identifier hs-var">i1</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span id="local-6989586621679080167"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679080167"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080173"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080169"><span class="hs-identifier hs-var">tz</span></a></span><span>
</span><span id="line-106"></span><span>            </span><span id="local-6989586621679080165"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621679080165"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080171"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080169"><span class="hs-identifier hs-var">tz</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080181"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080172"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080165"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080170"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; f a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080184"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080167"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">f a -&gt; (a -&gt; f a) -&gt; f a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; f a
</span><a href="#local-6989586621679080178"><span class="hs-identifier hs-var">goUpRt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080167"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080172"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080165"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080165"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f a) -&gt; (a -&gt; a) -&gt; a -&gt; f a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080170"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679080176"><span class="annot"><span class="annottext">goUpLt :: Int -&gt; Int -&gt; Int -&gt; a -&gt; f a
</span><a href="#local-6989586621679080176"><span class="hs-identifier hs-var hs-var">goUpLt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080163"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080163"><span class="hs-identifier hs-var">j1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080162"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080162"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080161"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080161"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080160"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080160"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080159"><span class="annot"><span class="annottext">to :: Int
</span><a href="#local-6989586621679080159"><span class="hs-identifier hs-var hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countTrailingZeros</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080163"><span class="hs-identifier hs-var">j1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>            </span><span id="local-6989586621679080158"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621679080158"><span class="hs-identifier hs-var hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080163"><span class="hs-identifier hs-var">j1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080159"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-113"></span><span>            </span><span id="local-6989586621679080157"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621679080157"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080161"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080159"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080162"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080157"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080180"><span class="hs-identifier hs-var">ql'</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080160"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; f a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080184"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080158"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">f a -&gt; (a -&gt; f a) -&gt; f a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; f a
</span><a href="#local-6989586621679080176"><span class="hs-identifier hs-var">goUpLt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080158"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080162"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080157"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080157"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f a) -&gt; (a -&gt; a) -&gt; a -&gt; f a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080160"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | Binary search in the intersection of (l, r) and (ql, qr) for the shortest prefix whose fold</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- satisfies the given monotonic predicate. Returns the end index and the fold. O(log n), or more</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- precisely O(log(min(r, qr) - max(l, ql) + 1)).</span><span>
</span><span id="line-121"></span><span id="local-6989586621679080154"><span id="local-6989586621679080155"><span id="local-6989586621679080156"><span class="annot"><a href="SegTreeMut.html#binSearchSTM"><span class="hs-identifier hs-type">binSearchSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080156"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080155"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080154"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-type">SegTreeMut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080155"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080154"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679080156"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-123"></span><span id="binSearchSTM"><span class="annot"><span class="annottext">binSearchSTM :: SegTreeMut marr a
-&gt; Int -&gt; Int -&gt; (a -&gt; Bool) -&gt; m (Maybe (Int, a))
</span><a href="SegTreeMut.html#binSearchSTM"><span class="hs-identifier hs-var hs-var">binSearchSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span id="local-6989586621679080153"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080153"><span class="hs-identifier hs-var">l0</span></a></span></span><span> </span><span id="local-6989586621679080152"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080152"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span id="local-6989586621679080151"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080151"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679080150"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080150"><span class="hs-identifier hs-var">xa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080149"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080149"><span class="hs-identifier hs-var">ql</span></a></span></span><span> </span><span id="local-6989586621679080148"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080148"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span id="local-6989586621679080147"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679080147"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080148"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080149"><span class="hs-identifier hs-var">ql</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m (Maybe (Int, a))
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;binSearchSTM: bad range&quot;</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080146"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080145"><span class="hs-identifier hs-var">ql'</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Int, a) -&gt; m (Maybe (Int, a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Int, a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; m (Maybe (Int, a))
forall (m :: * -&gt; *).
MArray marr a m =&gt;
Int -&gt; Int -&gt; Int -&gt; a -&gt; m (Maybe (Int, a))
</span><a href="#local-6989586621679080144"><span class="hs-identifier hs-var">goUpRt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080145"><span class="hs-identifier hs-var">ql'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080153"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080151"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080145"><span class="hs-identifier hs-var">ql'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679080145"><span class="annot"><span class="annottext">ql' :: Int
</span><a href="#local-6989586621679080145"><span class="hs-identifier hs-var hs-var">ql'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080153"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080149"><span class="hs-identifier hs-var">ql</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679080146"><span class="annot"><span class="annottext">qr' :: Int
</span><a href="#local-6989586621679080146"><span class="hs-identifier hs-var hs-var">qr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080152"><span class="hs-identifier hs-var">r0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080148"><span class="hs-identifier hs-var">qr</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679080144"><span class="annot"><span class="annottext">goUpRt :: Int -&gt; Int -&gt; Int -&gt; a -&gt; m (Maybe (Int, a))
</span><a href="#local-6989586621679080144"><span class="hs-identifier hs-var hs-var">goUpRt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080143"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080143"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080142"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080142"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080141"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080141"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080140"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080140"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080139"><span class="annot"><span class="annottext">tz :: Int
</span><a href="#local-6989586621679080139"><span class="hs-identifier hs-var hs-var">tz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countTrailingZeros</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080143"><span class="hs-identifier hs-var">i1</span></a></span><span>
</span><span id="line-132"></span><span>            </span><span id="local-6989586621679080138"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679080138"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080143"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080139"><span class="hs-identifier hs-var">tz</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span id="local-6989586621679080137"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621679080137"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080141"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080139"><span class="hs-identifier hs-var">tz</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080136"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080136"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080140"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; m a -&gt; m a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; m a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080150"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080138"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679080147"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080136"><span class="hs-identifier hs-var">acc'</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; m (Maybe (Int, a))
forall (m :: * -&gt; *).
MArray marr a m =&gt;
Int -&gt; Int -&gt; Int -&gt; a -&gt; m (Maybe (Int, a))
</span><a href="#local-6989586621679080135"><span class="hs-identifier hs-var">goDn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080138"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080142"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080137"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080140"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-137"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080142"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080137"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080146"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; m (Maybe (Int, a))
</span><a href="#local-6989586621679080144"><span class="hs-identifier hs-var">goUpRt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080138"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080142"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080137"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080137"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080136"><span class="hs-identifier hs-var">acc'</span></a></span><span>
</span><span id="line-138"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Int, a) -&gt; m (Maybe (Int, a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Int, a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679080135"><span class="annot"><span class="annottext">goDn :: Int -&gt; Int -&gt; Int -&gt; a -&gt; f (Maybe (Int, a))
</span><a href="#local-6989586621679080135"><span class="hs-identifier hs-var hs-var">goDn</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080133"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080133"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080132"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080132"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080131"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080131"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080130"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080130"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080146"><span class="hs-identifier hs-var">qr'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080132"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Int, a) -&gt; f (Maybe (Int, a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Int, a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080133"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080151"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679080129"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080129"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080130"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; f a -&gt; f a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; f a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080150"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080133"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679080147"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080129"><span class="hs-identifier hs-var">acc'</span></a></span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; f (Maybe (Int, a))
</span><a href="#local-6989586621679080135"><span class="hs-identifier hs-var">goDn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080133"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080132"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080131"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080130"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; a -&gt; f (Maybe (Int, a))
</span><a href="#local-6989586621679080135"><span class="hs-identifier hs-var">goDn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080133"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080132"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. (Bits a, Num a) =&gt; Int -&gt; a
</span><a href="Misc.html#unsafeBit"><span class="hs-identifier hs-var">unsafeBit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080131"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080131"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080129"><span class="hs-identifier hs-var">acc'</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679080128"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080128"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080130"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; f a -&gt; f a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; f a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080150"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080133"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Int, a) -&gt; f (Maybe (Int, a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, a) -&gt; Maybe (Int, a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080132"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080128"><span class="hs-identifier hs-var">acc'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Right fold over the elements of the segment tree. O(n).</span><span>
</span><span id="line-151"></span><span id="local-6989586621679080124"><span id="local-6989586621679080125"><span id="local-6989586621679080126"><span id="local-6989586621679080127"><span class="annot"><a href="SegTreeMut.html#foldrSTM"><span class="hs-identifier hs-type">foldrSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679080127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080126"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080127"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="SegTreeMut.html#SegTreeMut"><span class="hs-identifier hs-type">SegTreeMut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080126"><span class="hs-identifier hs-type">marr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080127"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080127"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080124"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080124"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080124"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080125"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080124"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-152"></span><span id="foldrSTM"><span class="annot"><span class="annottext">foldrSTM :: SegTreeMut marr a -&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; m b
</span><a href="SegTreeMut.html#foldrSTM"><span class="hs-identifier hs-var hs-var">foldrSTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTreeMut.html#STM"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span id="local-6989586621679080123"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080123"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679080122"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080122"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679080121"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080121"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679080120"><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080120"><span class="hs-identifier hs-var">xa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080119"><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621679080119"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679080118"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080118"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m b -&gt; m b) -&gt; m b -&gt; [Int] -&gt; m b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b -&gt; b) -&gt; m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621679080119"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m b -&gt; m b) -&gt; (Int -&gt; m a) -&gt; Int -&gt; m b -&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">marr Int a -&gt; Int -&gt; m a
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; m e
</span><span class="hs-identifier hs-var">readArray</span></span><span> </span><span class="annot"><span class="annottext">marr Int a
</span><a href="#local-6989586621679080120"><span class="hs-identifier hs-var">xa</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; m b
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080118"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080121"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080121"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080122"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080123"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- For tests</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- Allows specialization across modules</span><span>
</span><span id="line-158"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTreeMut.html#fromListSTM"><span class="hs-pragma hs-type">fromListSTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-159"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTreeMut.html#adjustSTM"><span class="hs-pragma hs-type">adjustSTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-160"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTreeMut.html#foldRangeSTM"><span class="hs-pragma hs-type">foldRangeSTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-161"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTreeMut.html#binSearchSTM"><span class="hs-pragma hs-type">binSearchSTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-162"></span></pre></body></html>