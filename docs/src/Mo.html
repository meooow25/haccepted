<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
== Mo's algorithm

Useful for answering certain range queries on a static sequence. The algorithm works by maintaining
some state for a current range, and updating the state by adding or removing elements one by one.
An important parameter for the algorithm is the block size. If the range size is n, number of
queries is q, block size is b, state update takes time f(n), getting the answer for the current
state takes g(n), then the algorithm answers all queries in
    O(q log q + bq * f(n) + n^2/b * f(n) + q * g(n))
A suitable value of block size minimizes run time.
For example, when q ~ n, f(n) = O(1), g(n) = O(1), setting b = sqrt(n) gives run time O(n sqrt(n)).
For f(n) = O(log n), a better choice of b is sqrt(n/log n) giving run time O(n sqrt(n log n)). In
practice, it works to experiment a bit and choose a good fixed value.

Sources:

* https://cp-algorithms.com/data_structures/sqrt_decomposition.html

-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Mo</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier">MoQuery</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mo.html#Tag"><span class="hs-identifier">Tag</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mo.html#runMo"><span class="hs-identifier">runMo</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mo.html#sqrtSize"><span class="hs-identifier">sqrtSize</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">type</span><span> </span><span id="Tag"><span class="annot"><a href="Mo.html#Tag"><span class="hs-identifier hs-var">Tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">data</span><span> </span><span id="MoQuery"><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-var">MoQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MoQuery"><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-var">MoQuery</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ql_"><span class="annot"><span class="annottext">MoQuery -&gt; Int
</span><a href="Mo.html#ql_"><span class="hs-identifier hs-var hs-var">ql_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="qr_"><span class="annot"><span class="annottext">MoQuery -&gt; Int
</span><a href="Mo.html#qr_"><span class="hs-identifier hs-var hs-var">qr_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="qtag_"><span class="annot"><span class="annottext">MoQuery -&gt; Int
</span><a href="Mo.html#qtag_"><span class="hs-identifier hs-var hs-var">qtag_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Mo.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679067150"><span id="local-6989586621679067152"><span id="local-6989586621679067154"><span class="annot"><span class="annottext">Int -&gt; MoQuery -&gt; ShowS
[MoQuery] -&gt; ShowS
MoQuery -&gt; String
(Int -&gt; MoQuery -&gt; ShowS)
-&gt; (MoQuery -&gt; String) -&gt; ([MoQuery] -&gt; ShowS) -&gt; Show MoQuery
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MoQuery] -&gt; ShowS
$cshowList :: [MoQuery] -&gt; ShowS
show :: MoQuery -&gt; String
$cshow :: MoQuery -&gt; String
showsPrec :: Int -&gt; MoQuery -&gt; ShowS
$cshowsPrec :: Int -&gt; MoQuery -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | Run Mo's algorithm given the block size, state update and answer functions, and queries. See above</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- for time complexity.</span><span>
</span><span id="line-36"></span><span id="local-6989586621679067147"><span id="local-6989586621679067148"><span class="annot"><a href="Mo.html#runMo"><span class="hs-identifier hs-type">runMo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679067148"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067148"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067148"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067148"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067147"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-type">MoQuery</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067148"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Mo.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679067147"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-37"></span><span id="runMo"><span class="annot"><span class="annottext">runMo :: Int
-&gt; (Int -&gt; m ())
-&gt; (Int -&gt; m ())
-&gt; m a
-&gt; [MoQuery]
-&gt; m [(Int, a)]
</span><a href="Mo.html#runMo"><span class="hs-identifier hs-var hs-var">runMo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>     </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">m a
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, a)] -&gt; m [(Int, a)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-38"></span><span class="annot"><a href="Mo.html#runMo"><span class="hs-identifier hs-var">runMo</span></a></span><span> </span><span id="local-6989586621679067146"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067146"><span class="hs-identifier hs-var">bsize</span></a></span></span><span> </span><span id="local-6989586621679067145"><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679067145"><span class="hs-identifier hs-var">add</span></a></span></span><span> </span><span id="local-6989586621679067144"><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679067144"><span class="hs-identifier hs-var">rem</span></a></span></span><span> </span><span id="local-6989586621679067143"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679067143"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span id="local-6989586621679067142"><span class="annot"><span class="annottext">[MoQuery]
</span><a href="#local-6989586621679067142"><span class="hs-identifier hs-var">qrys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MoQuery] -&gt; Int -&gt; Int -&gt; [(Int, a)] -&gt; m [(Int, a)]
</span><a href="#local-6989586621679067141"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[MoQuery]
</span><a href="#local-6989586621679067140"><span class="hs-identifier hs-var">qrys'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067139"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067139"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>    </span><span id="local-6989586621679067138"><span class="annot"><span class="annottext">cmp :: MoQuery -&gt; MoQuery -&gt; Ordering
</span><a href="#local-6989586621679067138"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-type">MoQuery</span></a></span><span> </span><span id="local-6989586621679067137"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067137"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621679067136"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067136"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-type">MoQuery</span></a></span><span> </span><span id="local-6989586621679067135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067135"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span id="local-6989586621679067134"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067134"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067132"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067131"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679067130"><span class="hs-identifier hs-var">rc</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679067132"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067132"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679067131"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067131"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067137"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067146"><span class="hs-identifier hs-var">bsize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067135"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067146"><span class="hs-identifier hs-var">bsize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>        </span><span id="local-6989586621679067130"><span class="annot"><span class="annottext">rc :: Ordering
</span><a href="#local-6989586621679067130"><span class="hs-identifier hs-var hs-var">rc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
forall a. Integral a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">even</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067132"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067136"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067134"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067134"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067136"><span class="hs-identifier hs-var">r1</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span id="local-6989586621679067140"><span class="annot"><span class="annottext">qrys' :: [MoQuery]
</span><a href="#local-6989586621679067140"><span class="hs-identifier hs-var hs-var">qrys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MoQuery -&gt; MoQuery -&gt; Ordering) -&gt; [MoQuery] -&gt; [MoQuery]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">MoQuery -&gt; MoQuery -&gt; Ordering
</span><a href="#local-6989586621679067138"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">[MoQuery]
</span><a href="#local-6989586621679067142"><span class="hs-identifier hs-var">qrys</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-type">MoQuery</span></a></span><span> </span><span id="local-6989586621679067139"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067139"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MoQuery] -&gt; MoQuery
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[MoQuery]
</span><a href="#local-6989586621679067140"><span class="hs-identifier hs-var">qrys'</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span id="local-6989586621679067141"><span class="annot"><span class="annottext">go :: [MoQuery] -&gt; Int -&gt; Int -&gt; [(Int, a)] -&gt; m [(Int, a)]
</span><a href="#local-6989586621679067141"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679067125"><span class="annot"><span class="annottext">[(Int, a)]
</span><a href="#local-6989586621679067125"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, a)] -&gt; m [(Int, a)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[(Int, a)]
</span><a href="#local-6989586621679067125"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="#local-6989586621679067141"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-type">MoQuery</span></a></span><span> </span><span id="local-6989586621679067124"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067124"><span class="hs-identifier hs-var">ql</span></a></span></span><span> </span><span id="local-6989586621679067123"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067123"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span id="local-6989586621679067122"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067122"><span class="hs-identifier hs-var">qtag</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679067121"><span class="annot"><span class="annottext">[MoQuery]
</span><a href="#local-6989586621679067121"><span class="hs-identifier hs-var">qrys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679067120"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067120"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679067119"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067119"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679067118"><span class="annot"><span class="annottext">[(Int, a)]
</span><a href="#local-6989586621679067118"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><span class="annottext">(Int -&gt; m ()) -&gt; [Int] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679067145"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; m ()) -&gt; [Int] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067120"><span class="hs-identifier hs-var">l</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067120"><span class="hs-identifier hs-var">l</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067124"><span class="hs-identifier hs-var">ql</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067119"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067123"><span class="hs-identifier hs-var">qr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><span class="annottext">(Int -&gt; m ()) -&gt; [Int] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679067144"><span class="hs-identifier hs-var">rem</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; m ()) -&gt; [Int] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067120"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067124"><span class="hs-identifier hs-var">ql</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067119"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067119"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067123"><span class="hs-identifier hs-var">qr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-48"></span><span>        </span><span id="local-6989586621679067115"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679067115"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679067143"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">[MoQuery] -&gt; Int -&gt; Int -&gt; [(Int, a)] -&gt; m [(Int, a)]
</span><a href="#local-6989586621679067141"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[MoQuery]
</span><a href="#local-6989586621679067121"><span class="hs-identifier hs-var">qrys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067124"><span class="hs-identifier hs-var">ql</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067123"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067122"><span class="hs-identifier hs-var">qtag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679067115"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Int, a) -&gt; [(Int, a)] -&gt; [(Int, a)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Int, a)]
</span><a href="#local-6989586621679067118"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Square root of an Int, rounded to an Int. O(1).</span><span>
</span><span id="line-52"></span><span class="annot"><a href="Mo.html#sqrtSize"><span class="hs-identifier hs-type">sqrtSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-53"></span><span id="sqrtSize"><span class="annot"><span class="annottext">sqrtSize :: Int -&gt; Int
</span><a href="Mo.html#sqrtSize"><span class="hs-identifier hs-var hs-var">sqrtSize</span></a></span></span><span> </span><span id="local-6989586621679067114"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067114"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Double -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067114"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- For tests</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Allows specialization across modules</span><span>
</span><span id="line-59"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Mo.html#runMo"><span class="hs-pragma hs-type">runMo</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Mo.html#MoQuery"><span class="hs-identifier hs-type">MoQuery</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621679067109"><span class="annot"><span class="annottext">rnf :: MoQuery -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MoQuery -&gt; ()
forall a. a -&gt; ()
</span><span class="hs-identifier hs-var">rwhnf</span></span><span>
</span><span id="line-63"></span></pre></body></html>