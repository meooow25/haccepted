<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
== Segment tree

A data structure supporting point updates and range queries on a sequence of monoids.
This implementation supports large ranges that do not fit in memory, sometimes called a dynamic or
sparse segment tree.

Sources:

* https://cp-algorithms.com/data_structures/segment_tree.html

The complexities below assume mappend takes O(1) time.
Let n = r - l + 1 in all instances below.

SegTree implementable Foldable. Folding over all the elements takes O(n).
-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">{-
Implementation notes:
* The segment tree is implemented as a complete binary tree. This uses more memory when the range
  size is away from the next power of 2, and the full tree is actually constructed, but the symmetry
  allows for an easy O(log n) construction of an empty tree.
* It is possible to build an empty segment tree in O(1) instead of O(log n). This can be done with
  special nodes that indicate that they can be grown, but this complicates the implementation.
  A lazy spine may also give an equivalent result, but structures with strict spines perform better
  in general. The O(log n) implementation seems like a good compromise to me.
* fromListST can be made to run in something like O(length xs + log n) instead of O(n) by falling
  back to the empty tree strategy when the list is exhausted. This will also reduce the memory usage
  mentioned in point 1, but I don't think it is worth the hassle.
* If the range is larger than 32-bits and this is to be run on a 32-bit system, you can replace Int
  with Int64.
-}</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SegTree</span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier">SegTree</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTree.html#emptyST"><span class="hs-identifier">emptyST</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTree.html#fromListST"><span class="hs-identifier">fromListST</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTree.html#boundsST"><span class="hs-identifier">boundsST</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTree.html#adjustST"><span class="hs-identifier">adjustST</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="SegTree.html#foldRangeST"><span class="hs-identifier">foldRangeST</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">data</span><span> </span><span id="SegTree"><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-var">SegTree</span></a></span></span><span> </span><span id="local-6989586621679069760"><span class="annot"><a href="#local-6989586621679069760"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SegTree"><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-var">SegTree</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069760"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679069655"><span id="local-6989586621679069657"><span id="local-6989586621679069659"><span class="annot"><span class="annottext">Int -&gt; SegTree a -&gt; ShowS
[SegTree a] -&gt; ShowS
SegTree a -&gt; String
(Int -&gt; SegTree a -&gt; ShowS)
-&gt; (SegTree a -&gt; String)
-&gt; ([SegTree a] -&gt; ShowS)
-&gt; Show (SegTree a)
forall a. Show a =&gt; Int -&gt; SegTree a -&gt; ShowS
forall a. Show a =&gt; [SegTree a] -&gt; ShowS
forall a. Show a =&gt; SegTree a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SegTree a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [SegTree a] -&gt; ShowS
show :: SegTree a -&gt; String
$cshow :: forall a. Show a =&gt; SegTree a -&gt; String
showsPrec :: Int -&gt; SegTree a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; SegTree a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="SegNode"><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-var">SegNode</span></a></span></span><span> </span><span id="local-6989586621679069759"><span class="annot"><a href="#local-6989586621679069759"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SLeaf"><span class="annot"><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-var">SLeaf</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679069759"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="SBin"><span class="annot"><a href="SegTree.html#SBin"><span class="hs-identifier hs-var">SBin</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679069759"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069759"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069759"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679069646"><span id="local-6989586621679069648"><span id="local-6989586621679069650"><span class="annot"><span class="annottext">Int -&gt; SegNode a -&gt; ShowS
[SegNode a] -&gt; ShowS
SegNode a -&gt; String
(Int -&gt; SegNode a -&gt; ShowS)
-&gt; (SegNode a -&gt; String)
-&gt; ([SegNode a] -&gt; ShowS)
-&gt; Show (SegNode a)
forall a. Show a =&gt; Int -&gt; SegNode a -&gt; ShowS
forall a. Show a =&gt; [SegNode a] -&gt; ShowS
forall a. Show a =&gt; SegNode a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SegNode a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [SegNode a] -&gt; ShowS
show :: SegNode a -&gt; String
$cshow :: forall a. Show a =&gt; SegNode a -&gt; String
showsPrec :: Int -&gt; SegNode a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; SegNode a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span id="local-6989586621679069751"><span class="annot"><a href="SegTree.html#buildST"><span class="hs-identifier hs-type">buildST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679069751"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069751"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069751"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-51"></span><span id="buildST"><span class="annot"><span class="annottext">buildST :: (Int, Int) -&gt; (Int -&gt; SegNode a) -&gt; SegTree a
</span><a href="SegTree.html#buildST"><span class="hs-identifier hs-var hs-var">buildST</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679069644"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069644"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069643"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069643"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069642"><span class="annot"><span class="annottext">Int -&gt; SegNode a
</span><a href="#local-6989586621679069642"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069641"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SegTree a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid range&quot;</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069641"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; SegNode a -&gt; SegTree a
forall a. (Int, Int, Int) -&gt; SegNode a -&gt; SegTree a
</span><a href="SegTree.html#SegTree"><span class="hs-identifier hs-var">SegTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069644"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069643"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SegNode a
forall a. a -&gt; SegNode a
</span><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-var">SLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; SegNode a -&gt; SegTree a
forall a. (Int, Int, Int) -&gt; SegNode a -&gt; SegTree a
</span><a href="SegTree.html#SegTree"><span class="hs-identifier hs-var">SegTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069644"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069643"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Bits a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">bit</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069637"><span class="hs-identifier hs-var">ht</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SegNode a
</span><a href="#local-6989586621679069642"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069637"><span class="hs-identifier hs-var">ht</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-56"></span><span>    </span><span id="local-6989586621679069641"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679069641"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069643"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069644"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621679069637"><span class="annot"><span class="annottext">ht :: Int
</span><a href="#local-6989586621679069637"><span class="hs-identifier hs-var hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069641"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countLeadingZeros</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069641"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Builds a segment tree on range (l, r) where each element is mempty. O(log n).</span><span>
</span><span id="line-60"></span><span id="local-6989586621679069634"><span class="annot"><a href="SegTree.html#emptyST"><span class="hs-identifier hs-type">emptyST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679069634"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069634"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-61"></span><span id="emptyST"><span class="annot"><span class="annottext">emptyST :: (Int, Int) -&gt; SegTree a
</span><a href="SegTree.html#emptyST"><span class="hs-identifier hs-var hs-var">emptyST</span></a></span></span><span> </span><span id="local-6989586621679069633"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679069633"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int -&gt; SegNode a) -&gt; SegTree a
forall a. Monoid a =&gt; (Int, Int) -&gt; (Int -&gt; SegNode a) -&gt; SegTree a
</span><a href="SegTree.html#buildST"><span class="hs-identifier hs-var">buildST</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679069633"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SegNode a
forall a a. (Eq a, Monoid a, Num a) =&gt; a -&gt; SegNode a
</span><a href="#local-6989586621679069632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621679069632"><span class="annot"><span class="annottext">go :: a -&gt; SegNode a
</span><a href="#local-6989586621679069632"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SegNode a
forall a. a -&gt; SegNode a
</span><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-var">SLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="#local-6989586621679069632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679069631"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069631"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SegNode a -&gt; SegNode a -&gt; SegNode a
forall a. a -&gt; SegNode a -&gt; SegNode a -&gt; SegNode a
</span><a href="SegTree.html#SBin"><span class="hs-identifier hs-var">SBin</span></a></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069630"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069630"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679069630"><span class="annot"><span class="annottext">lr :: SegNode a
</span><a href="#local-6989586621679069630"><span class="hs-identifier hs-var hs-var">lr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SegNode a
</span><a href="#local-6989586621679069632"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069631"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621679069723"><span class="annot"><a href="SegTree.html#makeSN"><span class="hs-identifier hs-type">makeSN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679069723"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069723"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069723"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069723"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-66"></span><span id="makeSN"><span class="annot"><span class="annottext">makeSN :: SegNode a -&gt; SegNode a -&gt; SegNode a
</span><a href="SegTree.html#makeSN"><span class="hs-identifier hs-var hs-var">makeSN</span></a></span></span><span> </span><span id="local-6989586621679069628"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069628"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679069627"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069627"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SegNode a -&gt; SegNode a -&gt; SegNode a
forall a. a -&gt; SegNode a -&gt; SegNode a -&gt; SegNode a
</span><a href="SegTree.html#SBin"><span class="hs-identifier hs-var">SBin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegNode a -&gt; a
forall p. SegNode p -&gt; p
</span><a href="#local-6989586621679069626"><span class="hs-identifier hs-var">getx</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069628"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; a
forall p. SegNode p -&gt; p
</span><a href="#local-6989586621679069626"><span class="hs-identifier hs-var">getx</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069627"><span class="hs-identifier hs-var">rt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069628"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069627"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679069626"><span class="annot"><span class="annottext">getx :: SegNode p -&gt; p
</span><a href="#local-6989586621679069626"><span class="hs-identifier hs-var hs-var">getx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-type">SLeaf</span></a></span><span> </span><span id="local-6989586621679069625"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679069625"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679069625"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="#local-6989586621679069626"><span class="hs-identifier hs-var">getx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SBin"><span class="hs-identifier hs-type">SBin</span></a></span><span> </span><span id="local-6989586621679069624"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679069624"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegNode p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SegNode p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679069624"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Builds a segment tree on (l, r) where the elements are taken from a list. If the list is shorter</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- than the range, the remaining elements are mempty. O(n).</span><span>
</span><span id="line-72"></span><span id="local-6989586621679069623"><span class="annot"><a href="SegTree.html#fromListST"><span class="hs-identifier hs-type">fromListST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679069623"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679069623"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069623"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-73"></span><span id="fromListST"><span class="annot"><span class="annottext">fromListST :: (Int, Int) -&gt; [a] -&gt; SegTree a
</span><a href="SegTree.html#fromListST"><span class="hs-identifier hs-var hs-var">fromListST</span></a></span></span><span> </span><span id="local-6989586621679069622"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679069622"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span id="local-6989586621679069621"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679069621"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int -&gt; SegNode a) -&gt; SegTree a
forall a. Monoid a =&gt; (Int, Int) -&gt; (Int -&gt; SegNode a) -&gt; SegTree a
</span><a href="SegTree.html#buildST"><span class="hs-identifier hs-var">buildST</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679069622"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(State [a] (SegNode a) -&gt; [a] -&gt; SegNode a)
-&gt; [a] -&gt; State [a] (SegNode a) -&gt; SegNode a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">State [a] (SegNode a) -&gt; [a] -&gt; SegNode a
forall s a. State s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679069621"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">(State [a] (SegNode a) -&gt; SegNode a)
-&gt; (Int -&gt; State [a] (SegNode a)) -&gt; Int -&gt; SegNode a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; State [a] (SegNode a)
forall a. (Eq a, Num a) =&gt; a -&gt; State [a] (SegNode a)
</span><a href="#local-6989586621679069617"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679069616"><span class="annot"><span class="annottext">pop :: StateT [a] Identity a
</span><a href="#local-6989586621679069616"><span class="hs-identifier hs-var hs-var">pop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; (a, [a])) -&gt; StateT [a] Identity a
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; (a, s)) -&gt; m a
</span><span class="hs-identifier hs-var">state</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; (a, [a])
forall a. Monoid a =&gt; [a] -&gt; (a, [a])
</span><a href="#local-6989586621679069614"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>        </span><span id="local-6989586621679069614"><span class="annot"><span class="annottext">go :: [a] -&gt; (a, [a])
</span><a href="#local-6989586621679069614"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="#local-6989586621679069614"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679069613"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069613"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679069612"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679069612"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069613"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679069612"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621679069617"><span class="annot"><span class="annottext">go :: a -&gt; State [a] (SegNode a)
</span><a href="#local-6989586621679069617"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SegNode a
forall a. a -&gt; SegNode a
</span><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-var">SLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; SegNode a) -&gt; StateT [a] Identity a -&gt; State [a] (SegNode a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT [a] Identity a
</span><a href="#local-6989586621679069616"><span class="hs-identifier hs-var">pop</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="#local-6989586621679069617"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679069610"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069610"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; SegNode a -&gt; SegNode a
forall a. Monoid a =&gt; SegNode a -&gt; SegNode a -&gt; SegNode a
</span><a href="SegTree.html#makeSN"><span class="hs-identifier hs-var">makeSN</span></a></span><span> </span><span class="annot"><span class="annottext">(SegNode a -&gt; SegNode a -&gt; SegNode a)
-&gt; State [a] (SegNode a)
-&gt; StateT [a] Identity (SegNode a -&gt; SegNode a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; State [a] (SegNode a)
</span><a href="#local-6989586621679069617"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069610"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateT [a] Identity (SegNode a -&gt; SegNode a)
-&gt; State [a] (SegNode a) -&gt; State [a] (SegNode a)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; State [a] (SegNode a)
</span><a href="#local-6989586621679069617"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069610"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- | The bounds of the segment tree. O(1).</span><span>
</span><span id="line-81"></span><span id="local-6989586621679069609"><span class="annot"><a href="SegTree.html#boundsST"><span class="hs-identifier hs-type">boundsST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069609"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-82"></span><span id="boundsST"><span class="annot"><span class="annottext">boundsST :: SegTree a -&gt; (Int, Int)
</span><a href="SegTree.html#boundsST"><span class="hs-identifier hs-var hs-var">boundsST</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679069608"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069608"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069607"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069607"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069608"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069607"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Adjusts the element at index i. O(log n).</span><span>
</span><span id="line-85"></span><span id="local-6989586621679069606"><span class="annot"><a href="SegTree.html#adjustST"><span class="hs-identifier hs-type">adjustST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-86"></span><span id="adjustST"><span class="annot"><span class="annottext">adjustST :: (a -&gt; a) -&gt; Int -&gt; SegTree a -&gt; SegTree a
</span><a href="SegTree.html#adjustST"><span class="hs-identifier hs-var hs-var">adjustST</span></a></span></span><span> </span><span id="local-6989586621679069605"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679069605"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679069604"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069604"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span id="local-6989586621679069603"><span class="annot"><span class="annottext">lrp :: (Int, Int, Int)
</span><a href="#local-6989586621679069603"><span class="hs-identifier hs-var">lrp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679069602"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069602"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069601"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069600"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069600"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069599"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069599"><span class="hs-identifier hs-var">root</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069604"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069602"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069601"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069604"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SegTree a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outside range&quot;</span></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; SegNode a -&gt; SegTree a
forall a. (Int, Int, Int) -&gt; SegNode a -&gt; SegTree a
</span><a href="SegTree.html#SegTree"><span class="hs-identifier hs-var">SegTree</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int)
</span><a href="#local-6989586621679069603"><span class="hs-identifier hs-var">lrp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; SegNode a
</span><a href="#local-6989586621679069597"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069599"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069602"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069602"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069600"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621679069597"><span class="annot"><span class="annottext">go :: SegNode a -&gt; Int -&gt; Int -&gt; SegNode a
</span><a href="#local-6989586621679069597"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679069595"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069595"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679069594"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069594"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679069593"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069593"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069604"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069594"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069593"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069604"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069595"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="#local-6989586621679069597"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-type">SLeaf</span></a></span><span> </span><span id="local-6989586621679069592"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069592"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SegNode a
forall a. a -&gt; SegNode a
</span><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-var">SLeaf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679069605"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069592"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="#local-6989586621679069597"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SBin"><span class="hs-identifier hs-type">SBin</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679069591"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069591"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679069590"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069590"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069589"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069589"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679069588"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069588"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; SegNode a -&gt; SegNode a
forall a. Monoid a =&gt; SegNode a -&gt; SegNode a -&gt; SegNode a
</span><a href="SegTree.html#makeSN"><span class="hs-identifier hs-var">makeSN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; SegNode a
</span><a href="#local-6989586621679069597"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069591"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069589"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069587"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; SegNode a
</span><a href="#local-6989586621679069597"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069590"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069587"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069588"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679069587"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621679069587"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069589"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069588"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Folds the elements in the range (ql, qr). Elements outside (l, r) are considered to be mempty.</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- O(log n).</span><span>
</span><span id="line-96"></span><span id="local-6989586621679069585"><span class="annot"><a href="SegTree.html#foldRangeST"><span class="hs-identifier hs-type">foldRangeST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679069585"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069585"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679069585"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-97"></span><span id="foldRangeST"><span class="annot"><span class="annottext">foldRangeST :: Int -&gt; Int -&gt; SegTree a -&gt; a
</span><a href="SegTree.html#foldRangeST"><span class="hs-identifier hs-var hs-var">foldRangeST</span></a></span></span><span> </span><span id="local-6989586621679069584"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069584"><span class="hs-identifier hs-var">ql</span></a></span></span><span> </span><span id="local-6989586621679069583"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069583"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegTree a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069584"><span class="hs-identifier hs-var">ql</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069583"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid range&quot;</span></span><span>
</span><span id="line-98"></span><span class="annot"><a href="SegTree.html#foldRangeST"><span class="hs-identifier hs-var">foldRangeST</span></a></span><span> </span><span id="local-6989586621679069581"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069581"><span class="hs-identifier hs-var">ql</span></a></span></span><span> </span><span id="local-6989586621679069580"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069580"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679069579"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069579"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069578"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069578"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069577"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069577"><span class="hs-identifier hs-var">root</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; a -&gt; a
forall a. Semigroup a =&gt; SegNode a -&gt; Int -&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679069576"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069577"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069579"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069579"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069578"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679069576"><span class="annot"><span class="annottext">go :: SegNode a -&gt; Int -&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679069576"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679069575"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069575"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679069574"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069574"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679069573"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069573"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069574"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069581"><span class="hs-identifier hs-var">ql</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069580"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069575"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069573"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="#local-6989586621679069576"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-type">SLeaf</span></a></span><span> </span><span id="local-6989586621679069572"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069572"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679069571"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069571"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069571"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069572"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="#local-6989586621679069576"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SBin"><span class="hs-identifier hs-type">SBin</span></a></span><span> </span><span id="local-6989586621679069570"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069570"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679069569"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069569"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679069568"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069568"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069567"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069567"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679069566"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069566"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679069565"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069565"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-102"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069581"><span class="hs-identifier hs-var">ql</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069567"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069566"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069580"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069565"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069570"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-103"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679069576"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069568"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069562"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069566"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679069576"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069569"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069567"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069562"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069565"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679069562"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621679069562"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069567"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069566"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679069528"><span id="local-6989586621679069530"><span id="local-6989586621679069532"><span id="local-6989586621679069534"><span id="local-6989586621679069536"><span id="local-6989586621679069538"><span id="local-6989586621679069540"><span id="local-6989586621679069542"><span id="local-6989586621679069544"><span id="local-6989586621679069546"><span id="local-6989586621679069548"><span id="local-6989586621679069550"><span id="local-6989586621679069552"><span id="local-6989586621679069555"><span id="local-6989586621679069557"><span id="local-6989586621679069559"><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679069526"><span class="annot"><span class="annottext">foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; SegTree a -&gt; b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">foldr</span></span></span><span> </span><span id="local-6989586621679069524"><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621679069524"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679069523"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679069523"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679069522"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069522"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069521"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069521"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679069520"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069520"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069519"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069519"><span class="hs-identifier hs-var">root</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; b -&gt; b
</span><a href="#local-6989586621679069518"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069519"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069522"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069522"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069520"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679069523"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>        </span><span id="local-6989586621679069518"><span class="annot"><span class="annottext">go :: SegNode a -&gt; Int -&gt; Int -&gt; b -&gt; b
</span><a href="#local-6989586621679069518"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679069517"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069517"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069517"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069521"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; b
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><a href="#local-6989586621679069518"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-type">SLeaf</span></a></span><span> </span><span id="local-6989586621679069515"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069515"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621679069524"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069515"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="#local-6989586621679069518"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SBin"><span class="hs-identifier hs-type">SBin</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679069514"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069514"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679069513"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069513"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679069512"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069512"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679069511"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069511"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; b -&gt; b
</span><a href="#local-6989586621679069518"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069514"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069512"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069510"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; (b -&gt; b) -&gt; b -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; Int -&gt; Int -&gt; b -&gt; b
</span><a href="#local-6989586621679069518"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069513"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069510"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069511"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679069510"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621679069510"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069512"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679069511"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- For tests</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- Allows specialization across modules</span><span>
</span><span id="line-116"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTree.html#fromListST"><span class="hs-pragma hs-type">fromListST</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-117"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTree.html#adjustST"><span class="hs-pragma hs-type">adjustST</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-118"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="SegTree.html#foldRangeST"><span class="hs-pragma hs-type">foldRangeST</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621679069509"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679069509"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069509"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679069506"><span class="annot"><span class="annottext">rnf :: SegTree a -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegTree"><span class="hs-identifier hs-type">SegTree</span></a></span><span> </span><span id="local-6989586621679069504"><span class="annot"><span class="annottext">(Int, Int, Int)
</span><a href="#local-6989586621679069504"><span class="hs-identifier hs-var">lrp</span></a></span></span><span> </span><span id="local-6989586621679069503"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069503"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int)
</span><a href="#local-6989586621679069504"><span class="hs-identifier hs-var">lrp</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069503"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621679069502"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679069502"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SegNode"><span class="hs-identifier hs-type">SegNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679069502"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679069500"><span class="annot"><span class="annottext">rnf :: SegNode a -&gt; ()
</span><a href="#local-6989586621679069500"><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SLeaf"><span class="hs-identifier hs-type">SLeaf</span></a></span><span> </span><span id="local-6989586621679069499"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069499"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069499"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SegTree.html#SBin"><span class="hs-identifier hs-type">SBin</span></a></span><span> </span><span id="local-6989586621679069498"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069498"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679069497"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679069496"><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069496"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679069498"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">SegNode a -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">SegNode a
</span><a href="#local-6989586621679069496"><span class="hs-identifier hs-var">rt</span></a></span></span><span>
</span><span id="line-126"></span></pre></body></html>