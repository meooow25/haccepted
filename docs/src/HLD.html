<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns, ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{-|
== Heavy-light decomposition

Decomposition of a tree of size n into multiple paths, such that there are O(log n) paths between
any pair of vertices.

HLD is useful for problems that have queries or updates on the path between two vertices.

This implementation maps each node to an integer position in [1..n] such that nodes in a path have
consecutive positions. A path between two vertices decomposes into O(log n) ranges of consecutive
integers, possibly simplifying the problem.

Sources:

* https://en.wikipedia.org/wiki/Heavy_path_decomposition
* https://cp-algorithms.com/graph/hld.html

-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-comment">{-
Implementation notes:
* The size array need not be stored if subtree queries are not required
-}</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HLD</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier">HLD</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HLD.html#buildHLD"><span class="hs-identifier">buildHLD</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HLD.html#posHLD"><span class="hs-identifier">posHLD</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HLD.html#pathHLD"><span class="hs-identifier">pathHLD</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HLD.html#edgePathHLD"><span class="hs-identifier">edgePathHLD</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HLD.html#subtreeHLD"><span class="hs-identifier">subtreeHLD</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HLD.html#lcaHLD"><span class="hs-identifier">lcaHLD</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.ST</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.Unboxed</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.Unsafe</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tree</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Misc.html"><span class="hs-identifier">Misc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Misc.html#maximumByMaybe"><span class="hs-identifier">maximumByMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">data</span><span> </span><span id="HLD"><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-var">HLD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HLD"><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-var">HLD</span></a></span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="par_"><span class="annot"><span class="annottext">HLD -&gt; UArray Vertex Vertex
</span><a href="HLD.html#par_"><span class="hs-identifier hs-var hs-var">par_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="dep_"><span class="annot"><span class="annottext">HLD -&gt; UArray Vertex Vertex
</span><a href="HLD.html#dep_"><span class="hs-identifier hs-var hs-var">dep_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="hed_"><span class="annot"><span class="annottext">HLD -&gt; UArray Vertex Vertex
</span><a href="HLD.html#hed_"><span class="hs-identifier hs-var hs-var">hed_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pos_"><span class="annot"><span class="annottext">HLD -&gt; UArray Vertex Vertex
</span><a href="HLD.html#pos_"><span class="hs-identifier hs-var hs-var">pos_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="siz_"><span class="annot"><span class="annottext">HLD -&gt; UArray Vertex Vertex
</span><a href="HLD.html#siz_"><span class="hs-identifier hs-var hs-var">siz_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UArray</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Builds the HLD structure from a tree. O(n).</span><span>
</span><span id="line-58"></span><span class="annot"><a href="HLD.html#buildHLD"><span class="hs-identifier hs-type">buildHLD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bounds</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span>
</span><span id="line-59"></span><span id="buildHLD"><span class="annot"><span class="annottext">buildHLD :: Bounds -&gt; Tree Vertex -&gt; HLD
</span><a href="HLD.html#buildHLD"><span class="hs-identifier hs-var hs-var">buildHLD</span></a></span></span><span> </span><span id="local-6989586621679077216"><span class="annot"><span class="annottext">Bounds
</span><a href="#local-6989586621679077216"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span id="local-6989586621679077215"><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077215"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
-&gt; UArray Vertex Vertex
-&gt; UArray Vertex Vertex
-&gt; UArray Vertex Vertex
-&gt; UArray Vertex Vertex
-&gt; HLD
</span><a href="HLD.html#HLD"><span class="hs-identifier hs-var">HLD</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077214"><span class="hs-identifier hs-var">par</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077213"><span class="hs-identifier hs-var">dep</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077212"><span class="hs-identifier hs-var">hed</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077211"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077210"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679077214"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077214"><span class="hs-identifier hs-var">par</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679077213"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077213"><span class="hs-identifier hs-var">dep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679077210"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077210"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s [UArray Vertex Vertex]) -&gt; [UArray Vertex Vertex]
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s [UArray Vertex Vertex]) -&gt; [UArray Vertex Vertex])
-&gt; (forall s. ST s [UArray Vertex Vertex])
-&gt; [UArray Vertex Vertex]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621679077208"><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077208"><span class="hs-identifier hs-var">pa</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679077207"><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077207"><span class="hs-identifier hs-var">da</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679077206"><span id="local-6989586621679077205"><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077205"><span class="hs-identifier hs-var">sa</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679077206"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vertex
-&gt; ST s (STUArray s Vertex Vertex)
-&gt; ST s [STUArray s Vertex Vertex]
forall (m :: * -&gt; *) a. Applicative m =&gt; Vertex -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">(ST s (STUArray s Vertex Vertex)
 -&gt; ST s [STUArray s Vertex Vertex])
-&gt; ST s (STUArray s Vertex Vertex)
-&gt; ST s [STUArray s Vertex Vertex]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; ST s (STUArray s Vertex Vertex)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray_</span></span><span> </span><span class="annot"><span class="annottext">Bounds
</span><a href="#local-6989586621679077216"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679077202"><span class="annot"><span class="annottext">go :: Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077202"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span id="local-6989586621679077200"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077200"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679077199"><span class="annot"><span class="annottext">Forest Vertex
</span><a href="#local-6989586621679077199"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679077198"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077198"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679077197"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077197"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>                </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077208"><span class="hs-identifier hs-var">pa</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077200"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077198"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-64"></span><span>                </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077207"><span class="hs-identifier hs-var">da</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077200"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077197"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679077206"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>                </span><span id="local-6989586621679077195"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077195"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vertex -&gt; Vertex) -&gt; ST s Vertex -&gt; ST s Vertex
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Tree Vertex -&gt; (Vertex -&gt; ST s Vertex) -&gt; Vertex -&gt; ST s Vertex)
-&gt; (Vertex -&gt; ST s Vertex)
-&gt; Forest Vertex
-&gt; Vertex
-&gt; ST s Vertex
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679077191"><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077191"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679077190"><span class="annot"><span class="annottext">Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077190"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679077189"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077189"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077202"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077191"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077200"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077197"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ST s Vertex -&gt; (Vertex -&gt; ST s Vertex) -&gt; ST s Vertex
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077190"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(Vertex -&gt; ST s Vertex)
-&gt; (Vertex -&gt; Vertex) -&gt; Vertex -&gt; ST s Vertex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077189"><span class="hs-identifier hs-var">acc</span></a></span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; ST s Vertex
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Forest Vertex
</span><a href="#local-6989586621679077199"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">0</span></span><span>
</span><span id="line-66"></span><span>                </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077195"><span class="hs-identifier hs-var">sm</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; ST s () -&gt; ST s Vertex
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077205"><span class="hs-identifier hs-var">sa</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077200"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077195"><span class="hs-identifier hs-var">sm</span></a></span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077202"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077215"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex
forall a. Tree a -&gt; a
</span><span class="hs-identifier hs-var hs-var">rootLabel</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077215"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">0</span></span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><span class="annottext">(STUArray s Vertex Vertex -&gt; ST s (UArray Vertex Vertex))
-&gt; [STUArray s Vertex Vertex] -&gt; ST s [UArray Vertex Vertex]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; ST s (UArray Vertex Vertex)
forall i (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) (b :: * -&gt; * -&gt; *).
(Ix i, MArray a e m, IArray b e) =&gt;
a i e -&gt; m (b i e)
</span><span class="hs-identifier hs-var">unsafeFreeze</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077208"><span class="hs-identifier hs-var">pa</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077207"><span class="hs-identifier hs-var">da</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077205"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679077212"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077212"><span class="hs-identifier hs-var">hed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679077211"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077211"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s [UArray Vertex Vertex]) -&gt; [UArray Vertex Vertex]
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s [UArray Vertex Vertex]) -&gt; [UArray Vertex Vertex])
-&gt; (forall s. ST s [UArray Vertex Vertex])
-&gt; [UArray Vertex Vertex]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621679077183"><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077183"><span class="hs-identifier hs-var">ha</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679077182"><span id="local-6989586621679077181"><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077181"><span class="hs-identifier hs-var">xa</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679077182"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vertex
-&gt; ST s (STUArray s Vertex Vertex)
-&gt; ST s [STUArray s Vertex Vertex]
forall (m :: * -&gt; *) a. Applicative m =&gt; Vertex -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(ST s (STUArray s Vertex Vertex)
 -&gt; ST s [STUArray s Vertex Vertex])
-&gt; ST s (STUArray s Vertex Vertex)
-&gt; ST s [STUArray s Vertex Vertex]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; ST s (STUArray s Vertex Vertex)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray_</span></span><span> </span><span class="annot"><span class="annottext">Bounds
</span><a href="#local-6989586621679077216"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-71"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679077180"><span class="annot"><span class="annottext">go :: Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077180"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span id="local-6989586621679077179"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077179"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679077178"><span class="annot"><span class="annottext">Forest Vertex
</span><a href="#local-6989586621679077178"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679077177"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077177"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679077176"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077176"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>                </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077183"><span class="hs-identifier hs-var">ha</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077179"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077177"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-73"></span><span>                </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; i -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">writeArray</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077181"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077179"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077176"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679077182"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Tree Vertex -&gt; Tree Vertex -&gt; Ordering)
-&gt; Forest Vertex -&gt; Maybe (Tree Vertex)
forall (f :: * -&gt; *) a.
Foldable f =&gt;
(a -&gt; a -&gt; Ordering) -&gt; f a -&gt; Maybe a
</span><a href="Misc.html#maximumByMaybe"><span class="hs-identifier hs-var">maximumByMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tree Vertex -&gt; Vertex) -&gt; Tree Vertex -&gt; Tree Vertex -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077210"><span class="hs-identifier hs-var">sz</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vertex -&gt; Vertex)
-&gt; (Tree Vertex -&gt; Vertex) -&gt; Tree Vertex -&gt; Vertex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex
forall a. Tree a -&gt; a
</span><span class="hs-identifier hs-var hs-var">rootLabel</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Forest Vertex
</span><a href="#local-6989586621679077178"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-75"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Tree Vertex)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; ST s Vertex
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077176"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679077173"><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077173"><span class="hs-identifier hs-var">heavy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-77"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679077172"><span class="annot"><span class="annottext">lights :: Forest Vertex
</span><a href="#local-6989586621679077172"><span class="hs-identifier hs-var hs-var">lights</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tree Vertex -&gt; Bool) -&gt; Forest Vertex -&gt; Forest Vertex
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex
forall a. Tree a -&gt; a
</span><span class="hs-identifier hs-var hs-var">rootLabel</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077173"><span class="hs-identifier hs-var">heavy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vertex -&gt; Bool) -&gt; (Tree Vertex -&gt; Vertex) -&gt; Tree Vertex -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex
forall a. Tree a -&gt; a
</span><span class="hs-identifier hs-var hs-var">rootLabel</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Forest Vertex
</span><a href="#local-6989586621679077178"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-78"></span><span>                        </span><span id="local-6989586621679077170"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077170"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077180"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077173"><span class="hs-identifier hs-var">heavy</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077177"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077176"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>                        </span><span class="annot"><span class="annottext">(Vertex -&gt; Tree Vertex -&gt; ST s Vertex)
-&gt; Vertex -&gt; Forest Vertex -&gt; ST s Vertex
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679077168"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077168"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679077167"><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077167"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077180"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077167"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex
forall a. Tree a -&gt; a
</span><span class="hs-identifier hs-var hs-var">rootLabel</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077167"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077168"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077170"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Forest Vertex
</span><a href="#local-6989586621679077172"><span class="hs-identifier hs-var">lights</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex -&gt; Vertex -&gt; ST s Vertex
</span><a href="#local-6989586621679077180"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077215"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Vertex -&gt; Vertex
forall a. Tree a -&gt; a
</span><span class="hs-identifier hs-var hs-var">rootLabel</span></span><span> </span><span class="annot"><span class="annottext">Tree Vertex
</span><a href="#local-6989586621679077215"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">0</span></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">(STUArray s Vertex Vertex -&gt; ST s (UArray Vertex Vertex))
-&gt; [STUArray s Vertex Vertex] -&gt; ST s [UArray Vertex Vertex]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex -&gt; ST s (UArray Vertex Vertex)
forall i (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) (b :: * -&gt; * -&gt; *).
(Ix i, MArray a e m, IArray b e) =&gt;
a i e -&gt; m (b i e)
</span><span class="hs-identifier hs-var">unsafeFreeze</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077183"><span class="hs-identifier hs-var">ha</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">STUArray s Vertex Vertex
</span><a href="#local-6989586621679077181"><span class="hs-identifier hs-var">xa</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | The position for the given vertex. O(1).</span><span>
</span><span id="line-84"></span><span class="annot"><a href="HLD.html#posHLD"><span class="hs-identifier hs-type">posHLD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-85"></span><span id="posHLD"><span class="annot"><span class="annottext">posHLD :: HLD -&gt; Vertex -&gt; Vertex
</span><a href="HLD.html#posHLD"><span class="hs-identifier hs-var hs-var">posHLD</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679077166"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077166"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077166"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="HLD.html#pathHLD_"><span class="hs-identifier hs-type">pathHLD_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-88"></span><span id="pathHLD_"><span class="annot"><span class="annottext">pathHLD_ :: Bool -&gt; HLD -&gt; Vertex -&gt; Vertex -&gt; [Bounds]
</span><a href="HLD.html#pathHLD_"><span class="hs-identifier hs-var hs-var">pathHLD_</span></a></span></span><span> </span><span id="local-6989586621679077164"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679077164"><span class="hs-identifier hs-var">keepLca</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span id="local-6989586621679077163"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077163"><span class="hs-identifier hs-var">par</span></a></span></span><span> </span><span id="local-6989586621679077162"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077162"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span id="local-6989586621679077161"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077161"><span class="hs-identifier hs-var">hed</span></a></span></span><span> </span><span id="local-6989586621679077160"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077160"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679077159"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077159"><span class="hs-identifier hs-var">u0</span></a></span></span><span> </span><span id="local-6989586621679077158"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077158"><span class="hs-identifier hs-var">v0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. (Bounds -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [Bounds]
forall a. (forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [a]
</span><span class="hs-identifier hs-var">build</span></span><span> </span><span class="annot"><span class="annottext">((forall b. (Bounds -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [Bounds])
-&gt; (forall b. (Bounds -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [Bounds]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679077157"><span class="annot"><span class="annottext">Bounds -&gt; b -&gt; b
</span><a href="#local-6989586621679077157"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679077156"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077156"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679077155"><span class="annot"><span class="annottext">go :: Vertex -&gt; Vertex -&gt; b
</span><a href="#local-6989586621679077155"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679077154"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077154"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679077153"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077153"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-90"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077162"><span class="hs-identifier hs-var">dep</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077152"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077162"><span class="hs-identifier hs-var">dep</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077150"><span class="hs-identifier hs-var">hv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; b
</span><a href="#local-6989586621679077155"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077153"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077154"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-91"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077152"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077150"><span class="hs-identifier hs-var">hv</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679077149"><span class="annot"><span class="annottext">xhv :: Vertex
</span><a href="#local-6989586621679077149"><span class="hs-identifier hs-var hs-var">xhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077160"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077150"><span class="hs-identifier hs-var">hv</span></a></span><span>
</span><span id="line-93"></span><span>                    </span><span class="hs-glyph">!</span><span id="local-6989586621679077148"><span class="annot"><span class="annottext">xv :: Vertex
</span><a href="#local-6989586621679077148"><span class="hs-identifier hs-var hs-var">xv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077160"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077153"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-94"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077149"><span class="hs-identifier hs-var">xhv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077148"><span class="hs-identifier hs-var">xv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; b -&gt; b
</span><a href="#local-6989586621679077157"><span class="hs-operator hs-var">`c`</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; b
</span><a href="#local-6989586621679077155"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077154"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077163"><span class="hs-identifier hs-var">par</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077150"><span class="hs-identifier hs-var">hv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679077147"><span class="annot"><span class="annottext">minmax :: b -&gt; b -&gt; (b, b)
</span><a href="#local-6989586621679077147"><span class="hs-identifier hs-var hs-var">minmax</span></a></span></span><span> </span><span id="local-6989586621679077146"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077146"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679077145"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077145"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077146"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077145"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077146"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077145"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077145"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077146"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>                    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679077143"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077143"><span class="hs-identifier hs-var">xu</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679077142"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077142"><span class="hs-identifier hs-var">xv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bounds
forall b. Ord b =&gt; b -&gt; b -&gt; (b, b)
</span><a href="#local-6989586621679077147"><span class="hs-identifier hs-var">minmax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077160"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077154"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077160"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077153"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-99"></span><span>                    </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679077164"><span class="hs-identifier hs-var">keepLca</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077143"><span class="hs-identifier hs-var">xu</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077142"><span class="hs-identifier hs-var">xv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; b -&gt; b
</span><a href="#local-6989586621679077157"><span class="hs-operator hs-var">`c`</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077156"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-100"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077143"><span class="hs-identifier hs-var">xu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077142"><span class="hs-identifier hs-var">xv</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077156"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-101"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077143"><span class="hs-identifier hs-var">xu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077142"><span class="hs-identifier hs-var">xv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; b -&gt; b
</span><a href="#local-6989586621679077157"><span class="hs-operator hs-var">`c`</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679077156"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-102"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679077152"><span class="annot"><span class="annottext">hu :: Vertex
</span><a href="#local-6989586621679077152"><span class="hs-identifier hs-var hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077161"><span class="hs-identifier hs-var">hed</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077154"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679077150"><span class="annot"><span class="annottext">hv :: Vertex
</span><a href="#local-6989586621679077150"><span class="hs-identifier hs-var hs-var">hv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077161"><span class="hs-identifier hs-var">hed</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077153"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; b
</span><a href="#local-6989586621679077155"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077159"><span class="hs-identifier hs-var">u0</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077158"><span class="hs-identifier hs-var">v0</span></a></span><span>
</span><span id="line-106"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="HLD.html#pathHLD_"><span class="hs-pragma hs-type">pathHLD_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | A list of position ranges which make up the path from u to v. O(log n).</span><span>
</span><span id="line-109"></span><span class="annot"><a href="HLD.html#pathHLD"><span class="hs-identifier hs-type">pathHLD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span id="pathHLD"><span class="annot"><span class="annottext">pathHLD :: HLD -&gt; Vertex -&gt; Vertex -&gt; [Bounds]
</span><a href="HLD.html#pathHLD"><span class="hs-identifier hs-var hs-var">pathHLD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HLD -&gt; Vertex -&gt; Vertex -&gt; [Bounds]
</span><a href="HLD.html#pathHLD_"><span class="hs-identifier hs-var">pathHLD_</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-111"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="HLD.html#pathHLD"><span class="hs-pragma hs-type">pathHLD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | pathsHLD but excludes the LCA. Useful when working with edges, each edge can be mapped to the node</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- it leads down into. O(log n).</span><span>
</span><span id="line-115"></span><span class="annot"><a href="HLD.html#edgePathHLD"><span class="hs-identifier hs-type">edgePathHLD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span id="edgePathHLD"><span class="annot"><span class="annottext">edgePathHLD :: HLD -&gt; Vertex -&gt; Vertex -&gt; [Bounds]
</span><a href="HLD.html#edgePathHLD"><span class="hs-identifier hs-var hs-var">edgePathHLD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HLD -&gt; Vertex -&gt; Vertex -&gt; [Bounds]
</span><a href="HLD.html#pathHLD_"><span class="hs-identifier hs-var">pathHLD_</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-117"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="HLD.html#edgePathHLD"><span class="hs-pragma hs-type">edgePathHLD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | A position range covering the subtree of the given node. O(1).</span><span>
</span><span id="line-120"></span><span class="annot"><a href="HLD.html#subtreeHLD"><span class="hs-identifier hs-type">subtreeHLD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span id="subtreeHLD"><span class="annot"><span class="annottext">subtreeHLD :: HLD -&gt; Vertex -&gt; Bounds
</span><a href="HLD.html#subtreeHLD"><span class="hs-identifier hs-var hs-var">subtreeHLD</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679077141"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077141"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679077140"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077140"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679077139"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077139"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077141"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077139"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077141"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077139"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077140"><span class="hs-identifier hs-var">sz</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077139"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | The lowest common ancestor of two vertices. O(log n).</span><span>
</span><span id="line-124"></span><span class="annot"><a href="HLD.html#lcaHLD"><span class="hs-identifier hs-type">lcaHLD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vertex</span></span><span>
</span><span id="line-125"></span><span id="lcaHLD"><span class="annot"><span class="annottext">lcaHLD :: HLD -&gt; Vertex -&gt; Vertex -&gt; Vertex
</span><a href="HLD.html#lcaHLD"><span class="hs-identifier hs-var hs-var">lcaHLD</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span id="local-6989586621679077138"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077138"><span class="hs-identifier hs-var">par</span></a></span></span><span> </span><span id="local-6989586621679077137"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077137"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span id="local-6989586621679077136"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077136"><span class="hs-identifier hs-var">hed</span></a></span></span><span> </span><span id="local-6989586621679077135"><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077135"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
</span><a href="#local-6989586621679077134"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679077134"><span class="annot"><span class="annottext">go :: Vertex -&gt; Vertex -&gt; Vertex
</span><a href="#local-6989586621679077134"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679077133"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077133"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679077132"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077132"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077137"><span class="hs-identifier hs-var">dep</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077131"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077137"><span class="hs-identifier hs-var">dep</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077130"><span class="hs-identifier hs-var">hv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
</span><a href="#local-6989586621679077134"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077132"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077133"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077131"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077130"><span class="hs-identifier hs-var">hv</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Vertex
</span><a href="#local-6989586621679077134"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077133"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077138"><span class="hs-identifier hs-var">par</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077130"><span class="hs-identifier hs-var">hv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679077129"><span class="annot"><span class="annottext">xu :: Vertex
</span><a href="#local-6989586621679077129"><span class="hs-identifier hs-var hs-var">xu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077135"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077133"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-130"></span><span>                                </span><span class="hs-glyph">!</span><span id="local-6989586621679077128"><span class="annot"><span class="annottext">xv :: Vertex
</span><a href="#local-6989586621679077128"><span class="hs-identifier hs-var hs-var">xv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077135"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077132"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-131"></span><span>                            </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077129"><span class="hs-identifier hs-var">xu</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Vertex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077128"><span class="hs-identifier hs-var">xv</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077133"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077132"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679077131"><span class="annot"><span class="annottext">hu :: Vertex
</span><a href="#local-6989586621679077131"><span class="hs-identifier hs-var hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077136"><span class="hs-identifier hs-var">hed</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077133"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679077130"><span class="annot"><span class="annottext">hv :: Vertex
</span><a href="#local-6989586621679077130"><span class="hs-identifier hs-var hs-var">hv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UArray Vertex Vertex
</span><a href="#local-6989586621679077136"><span class="hs-identifier hs-var">hed</span></a></span><span class="annot"><span class="annottext">UArray Vertex Vertex -&gt; Vertex -&gt; Vertex
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621679077132"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- For tests</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="HLD.html#HLD"><span class="hs-identifier hs-type">HLD</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679077124"><span class="annot"><span class="annottext">rnf :: HLD -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HLD -&gt; ()
forall a. a -&gt; ()
</span><span class="hs-identifier hs-var">rwhnf</span></span><span>
</span><span id="line-141"></span></pre></body></html>